ğŸƒ 00_smoke: c orc debug execute                                     
ğŸƒ 00_smoke: c arc debug execute                                     
ğŸƒ 00_smoke: c orc release execute                                   
ğŸƒ 00_smoke: c arc release execute                                   
ğŸƒ 10_loops: c arc release execute                                   
ğŸƒ 10_loops: c orc release execute                                   
ğŸƒ 10_loops: c arc debug execute                                     
ğŸƒ 10_loops_skipped: c arc release execute                           
ğŸƒ 10_loops: c orc debug execute                                     
ğŸƒ 10_loops_skipped: c arc debug execute                             
ğŸƒ 10_loops_skipped: c orc release execute                           
ğŸƒ 20_api: c orc debug execute                                       
ğŸƒ 20_api: c arc release execute                                     
ğŸƒ 20_api: c orc release execute                                     
ğŸƒ 10_loops_skipped: c orc debug execute                             
ğŸƒ 20_api: c arc debug execute                                       
ğŸŸ¢ 00_smoke: c arc debug execute                                         2.3s
ğŸƒ 25_compile_fail_wrapper: c arc debug execute                      
ğŸŸ¢ 00_smoke: c orc debug execute                                         2.4s
ğŸƒ 25_compile_fail_wrapper: c orc debug execute                      
ğŸŸ¢ 10_loops_skipped: c arc debug execute                                 2.5s
ğŸƒ 25_compile_fail_wrapper: c arc release execute                    
ğŸŸ¢ 10_loops_skipped: c orc debug execute                                 2.5s
ğŸƒ 25_compile_fail_wrapper: c orc release execute                    
ğŸŸ¢ 10_loops: c arc debug execute                                         3.4s
ğŸƒ 25_compile_ok_magic_generic: c arc debug execute                  
ğŸŸ¢ 10_loops: c orc debug execute                                         3.5s
ğŸƒ 25_compile_ok_magic_generic: c orc debug execute                  
ğŸŸ¢ 00_smoke: c arc release execute                                       3.6s
ğŸƒ 25_compile_ok_magic_generic: c arc release execute                
ğŸŸ¢ 10_loops_skipped: c arc release execute                               3.8s
ğŸƒ 25_compile_ok_magic_generic: c orc release execute                
ğŸŸ¢ 00_smoke: c orc release execute                                       3.8s
ğŸƒ 25_compile_ok_using: c arc debug execute                          
ğŸŸ¢ 20_api: c arc debug execute                                           3.9s
ğŸƒ 25_compile_ok_using: c orc debug execute                          
ğŸŸ¢ 20_api: c orc debug execute                                           3.9s
ğŸƒ 25_compile_ok_using: c arc release execute                        
ğŸŸ¢ 10_loops_skipped: c orc release execute                               4.0s
ğŸƒ 25_compile_ok_using: c orc release execute                        
ğŸŸ¢ 25_compile_ok_magic_generic: c arc debug execute                      1.3s
ğŸƒ 30_cc: c arc debug execute                                        
ğŸŸ¢ 25_compile_ok_magic_generic: c orc debug execute                      1.3s
ğŸƒ 30_cc: c orc debug execute                                        
ğŸŸ¢ 10_loops: c arc release execute                                       5.0s
ğŸƒ 30_cc: c arc release execute                                      
ğŸŸ¢ 10_loops: c orc release execute                                       5.2s
ğŸƒ 30_cc: c orc release execute                                      
ğŸŸ¢ 25_compile_ok_magic_generic: c arc release execute                    1.7s
ğŸƒ 40_ast: c arc debug execute                                       
ğŸŸ¢ 25_compile_ok_using: c arc debug execute                              1.5s
ğŸƒ 40_ast: c orc debug execute                                       
ğŸŸ¢ 25_compile_ok_using: c orc debug execute                              1.6s
ğŸƒ 40_ast: c arc release execute                                     
ğŸŸ¢ 25_compile_ok_magic_generic: c orc release execute                    1.8s
ğŸƒ 40_ast: c orc release execute                                     
ğŸŸ¢ 20_api: c arc release execute                                         5.7s
ğŸƒ 50_hooks: c arc debug execute                                     
ğŸŸ¢ 20_api: c orc release execute                                         5.9s
ğŸƒ 50_hooks: c orc debug execute                                     
ğŸŸ¢ 25_compile_ok_using: c arc release execute                            2.3s
ğŸƒ 50_hooks: c arc release execute                                   
ğŸŸ¢ 25_compile_ok_using: c orc release execute                            2.4s
ğŸƒ 50_hooks: c orc release execute                                   
ğŸŸ¢ 25_compile_fail_wrapper: c arc debug execute                          4.2s
ğŸƒ 51_hooks_extended: c arc debug execute                            
ğŸŸ¢ 25_compile_fail_wrapper: c orc debug execute                          4.2s
ğŸƒ 51_hooks_extended: c orc debug execute                            
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t30_cc.nim
#4291/1 okay.
/run/user/1000/balls-nimcache-2203862776.c.debug.arc-4186/30_cc_4291_-7869063994641872504
#4291/2 fail!
[3m[90m## [3m[97mcalling convention[0m
ğŸŸ¢ [32msome different callback types[0m
ğŸŸ¢ [32mproduce callbacks from a symbol[0m
ğŸŸ¢ [32mproduce callbacks that match whelp types[0m
ğŸŸ¢ [32mexecute a callback with arguments[0m
â›” [1m[7m[48;2;255;255;255m[91mcallbacks run from inside cps run pass, tail, etc.: compile failed[0m
â›” ğŸ—[3m[90m   62[0m  [39mblock:
â›” [0mğŸ—[3m[90m   63[0m  [39m  ## callbacks run from inside cps run pass, tail, etc.
â›” [0mğŸ—[3m[90m   64[0m  [39m  var k = newKiller 7
â›” [0mğŸ—[3m[90m   65[0m  [39m  type
â›” [0mğŸ—[3m[90m   66[0m  [39m    ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m   67[0m  [39m  proc tail(c: Continuation; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   68[0m  [39m    d.mom = c
â›” [0mğŸ—[3m[90m   69[0m  [39m    step 3
â›” [0mğŸ—[3m[90m   70[0m  [39m    d
â›” [0mğŸ—[3m[90m   71[0m  [39m
â›” [0mğŸ—[3m[90m   72[0m  [39m  proc pass(c: Cont; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   73[0m  [39m    step 4
â›” [0mğŸ—[3m[90m   74[0m  [39m    d
â›” [0mğŸ—[3m[90m   75[0m  [39m
â›” [0mğŸ—[3m[90m   76[0m  [39m  proc head(c: Cont): Cont =
â›” [0mğŸ—[3m[90m   77[0m  [39m    step 1
â›” [0mğŸ—[3m[90m   78[0m  [39m    c
â›” [0mğŸ—[3m[90m   79[0m  [39m
â›” [0mğŸ—[3m[90m   80[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   81[0m  [39m    noop()
â›” [0mğŸ—[3m[90m   82[0m  [39m    step 5
â›” [0mğŸ—[3m[90m   83[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m   84[0m  [39m
â›” [0mğŸ—[3m[90m   85[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   86[0m  [39m    step 2
â›” [0mğŸ—[3m[90m   87[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m   88[0m  [39m    step 6
â›” [0mğŸ—[3m[90m   89[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m   90[0m  [39m    step 7
â›” [0mğŸ—[3m[90m   91[0m  [39m
â›” [0mğŸ—[3m[90m   92[0m  [39m  foo:
â›” [0mğŸ—[3m[90m   93[0m  [39m    whelp bar
â›” [0mğŸ—[3m[90m   94[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mwhelp helps disambiguate cps callbacks at instantiation: compile failed[0m
â›” ğŸ—[3m[90m   97[0m  [39mblock:
â›” [0mğŸ—[3m[90m   98[0m  [39m  ## whelp helps disambiguate cps callbacks at instantiation
â›” [0mğŸ—[3m[90m   99[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  100[0m  [39m  type
â›” [0mğŸ—[3m[90m  101[0m  [39m    ContCall {.used.} = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  102[0m  [39m    MoreCall {.used.} = proc (a: float): float {.cps: Cont.}
â›” [0mğŸ—[3m[90m  103[0m  [39m  proc bar(a: float): float {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  104[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  105[0m  [39m    return a * 2.0
â›” [0mğŸ—[3m[90m  106[0m  [39m
â›” [0mğŸ—[3m[90m  107[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  108[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  109[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  110[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m  111[0m  [39m
â›” [0mğŸ—[3m[90m  112[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  113[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  114[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m  115[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m  116[0m  [39m
â›” [0mğŸ—[3m[90m  117[0m  [39m  foo:
â›” [0mğŸ—[3m[90m  118[0m  [39m    whelp(ContCall, bar)
â›” [0mğŸ—[3m[90m  119[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback in cps with natural syntax: compile failed[0m
â›” ğŸ—[3m[90m  122[0m  [39mblock:
â›” [0mğŸ—[3m[90m  123[0m  [39m  ## run a callback in cps with natural syntax
â›” [0mğŸ—[3m[90m  124[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  125[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  126[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  127[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  128[0m  [39m  else:
â›” [0mğŸ—[3m[90m  129[0m  [39m    type
â›” [0mğŸ—[3m[90m  130[0m  [39m      ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  131[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  132[0m  [39m    proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  133[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  134[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  135[0m  [39m      return a * 2
â›” [0mğŸ—[3m[90m  136[0m  [39m
â›” [0mğŸ—[3m[90m  137[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  138[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  139[0m  [39m      let x = c(4)
â›” [0mğŸ—[3m[90m  140[0m  [39m      check x == 8
â›” [0mğŸ—[3m[90m  141[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  142[0m  [39m
â›” [0mğŸ—[3m[90m  143[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  144[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  145[0m  [39m    check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback with no return value in cps: compile failed[0m
â›” ğŸ—[3m[90m  149[0m  [39mblock:
â›” [0mğŸ—[3m[90m  150[0m  [39m  ## run a callback with no return value in cps
â›” [0mğŸ—[3m[90m  151[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  152[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  153[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  154[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  155[0m  [39m  else:
â›” [0mğŸ—[3m[90m  156[0m  [39m    type
â›” [0mğŸ—[3m[90m  157[0m  [39m      ContCall = proc (a: int) {.cps: Cont.}
â›” [0mğŸ—[3m[90m  158[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  159[0m  [39m    proc bar(a: int) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  160[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  161[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  162[0m  [39m
â›” [0mğŸ—[3m[90m  163[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  164[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  165[0m  [39m      c(4)
â›” [0mğŸ—[3m[90m  166[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  167[0m  [39m
â›” [0mğŸ—[3m[90m  168[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  169[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  170[0m  [39m    check k[0m
ğŸŸ¢ [32mcallback illustration[0m
[3m[90m## [3m[97m9 tests  [0m          ğŸŸ¢5          â›”4
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
