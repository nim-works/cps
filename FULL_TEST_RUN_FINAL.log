ğŸƒ 00_smoke: c arc debug execute                                     
ğŸƒ 00_smoke: c arc release execute                                   
ğŸƒ 00_smoke: c orc release execute                                   
ğŸƒ 10_loops: c orc debug execute                                     
ğŸƒ 00_smoke: c orc debug execute                                     
ğŸƒ 10_loops: c arc release execute                                   
ğŸƒ 10_loops: c orc release execute                                   
ğŸƒ 10_loops_skipped: c arc debug execute                             
ğŸƒ 10_loops_skipped: c orc debug execute                             
ğŸƒ 20_api: c orc debug execute                                       
ğŸƒ 10_loops: c arc debug execute                                     
ğŸƒ 10_loops_skipped: c arc release execute                           
ğŸƒ 10_loops_skipped: c orc release execute                           
ğŸƒ 20_api: c arc release execute                                     
ğŸƒ 20_api: c arc debug execute                                       
ğŸƒ 20_api: c orc release execute                                     
ğŸŸ¢ 00_smoke: c orc debug execute                                         2.4s
ğŸƒ 25_compile_fail_wrapper: c arc debug execute                      
ğŸŸ¢ 00_smoke: c arc debug execute                                         2.4s
ğŸƒ 25_compile_fail_wrapper: c orc debug execute                      
ğŸŸ¢ 10_loops_skipped: c arc debug execute                                 2.5s
ğŸƒ 25_compile_fail_wrapper: c arc release execute                    
ğŸŸ¢ 10_loops_skipped: c orc debug execute                                 2.6s
ğŸƒ 25_compile_fail_wrapper: c orc release execute                    
ğŸŸ¢ 10_loops: c orc debug execute                                         3.4s
ğŸƒ 25_compile_ok_magic_generic: c arc debug execute                  
ğŸŸ¢ 10_loops: c arc debug execute                                         3.4s
ğŸƒ 25_compile_ok_magic_generic: c orc debug execute                  
ğŸŸ¢ 00_smoke: c arc release execute                                       3.7s
ğŸƒ 25_compile_ok_magic_generic: c arc release execute                
ğŸŸ¢ 20_api: c arc debug execute                                           3.8s
ğŸƒ 25_compile_ok_magic_generic: c orc release execute                
ğŸŸ¢ 00_smoke: c orc release execute                                       3.9s
ğŸƒ 25_compile_ok_using: c arc debug execute                          
ğŸŸ¢ 10_loops_skipped: c arc release execute                               3.9s
ğŸƒ 25_compile_ok_using: c orc debug execute                          
ğŸŸ¢ 20_api: c orc debug execute                                           3.9s
ğŸƒ 25_compile_ok_using: c arc release execute                        
ğŸŸ¢ 10_loops_skipped: c orc release execute                               4.1s
ğŸƒ 25_compile_ok_using: c orc release execute                        
ğŸŸ¢ 25_compile_ok_magic_generic: c arc debug execute                      1.3s
ğŸƒ 30_cc: c arc debug execute                                        
ğŸŸ¢ 25_compile_ok_magic_generic: c orc debug execute                      1.4s
ğŸƒ 30_cc: c orc debug execute                                        
ğŸŸ¢ 10_loops: c arc release execute                                       4.9s
ğŸƒ 30_cc: c arc release execute                                      
ğŸŸ¢ 10_loops: c orc release execute                                       5.2s
ğŸƒ 30_cc: c orc release execute                                      
ğŸŸ¢ 25_compile_ok_magic_generic: c arc release execute                    1.7s
ğŸƒ 40_ast: c arc debug execute                                       
ğŸŸ¢ 25_compile_ok_using: c arc debug execute                              1.5s
ğŸƒ 40_ast: c orc debug execute                                       
ğŸŸ¢ 25_compile_ok_using: c orc debug execute                              1.6s
ğŸƒ 40_ast: c arc release execute                                     
ğŸŸ¢ 25_compile_ok_magic_generic: c orc release execute                    1.8s
ğŸƒ 40_ast: c orc release execute                                     
ğŸŸ¢ 20_api: c arc release execute                                         5.8s
ğŸƒ 50_hooks: c arc debug execute                                     
ğŸŸ¢ 20_api: c orc release execute                                         6.0s
ğŸƒ 50_hooks: c orc debug execute                                     
ğŸŸ¢ 25_compile_ok_using: c arc release execute                            2.2s
ğŸƒ 50_hooks: c arc release execute                                   
ğŸŸ¢ 25_compile_ok_using: c orc release execute                            2.5s
ğŸƒ 50_hooks: c orc release execute                                   
ğŸŸ¢ 25_compile_fail_wrapper: c arc debug execute                          4.2s
ğŸƒ 51_hooks_extended: c arc debug execute                            
ğŸŸ¢ 25_compile_fail_wrapper: c orc debug execute                          4.2s
ğŸƒ 51_hooks_extended: c orc debug execute                            
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t30_cc.nim
#24637/1 okay.
/run/user/1000/balls-nimcache-2203862776.c.debug.arc-24525/30_cc_24637_-7869063994641872504
#24637/2 fail!
[3m[90m## [3m[97mcalling convention[0m
ğŸŸ¢ [32msome different callback types[0m
ğŸŸ¢ [32mproduce callbacks from a symbol[0m
ğŸŸ¢ [32mproduce callbacks that match whelp types[0m
ğŸŸ¢ [32mexecute a callback with arguments[0m
â›” [1m[7m[48;2;255;255;255m[91mcallbacks run from inside cps run pass, tail, etc.: compile failed[0m
â›” ğŸ—[3m[90m   62[0m  [39mblock:
â›” [0mğŸ—[3m[90m   63[0m  [39m  ## callbacks run from inside cps run pass, tail, etc.
â›” [0mğŸ—[3m[90m   64[0m  [39m  var k = newKiller 7
â›” [0mğŸ—[3m[90m   65[0m  [39m  type
â›” [0mğŸ—[3m[90m   66[0m  [39m    ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m   67[0m  [39m  proc tail(c: Continuation; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   68[0m  [39m    d.mom = c
â›” [0mğŸ—[3m[90m   69[0m  [39m    step 3
â›” [0mğŸ—[3m[90m   70[0m  [39m    d
â›” [0mğŸ—[3m[90m   71[0m  [39m
â›” [0mğŸ—[3m[90m   72[0m  [39m  proc pass(c: Cont; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   73[0m  [39m    step 4
â›” [0mğŸ—[3m[90m   74[0m  [39m    d
â›” [0mğŸ—[3m[90m   75[0m  [39m
â›” [0mğŸ—[3m[90m   76[0m  [39m  proc head(c: Cont): Cont =
â›” [0mğŸ—[3m[90m   77[0m  [39m    step 1
â›” [0mğŸ—[3m[90m   78[0m  [39m    c
â›” [0mğŸ—[3m[90m   79[0m  [39m
â›” [0mğŸ—[3m[90m   80[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   81[0m  [39m    noop()
â›” [0mğŸ—[3m[90m   82[0m  [39m    step 5
â›” [0mğŸ—[3m[90m   83[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m   84[0m  [39m
â›” [0mğŸ—[3m[90m   85[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   86[0m  [39m    step 2
â›” [0mğŸ—[3m[90m   87[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m   88[0m  [39m    step 6
â›” [0mğŸ—[3m[90m   89[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m   90[0m  [39m    step 7
â›” [0mğŸ—[3m[90m   91[0m  [39m
â›” [0mğŸ—[3m[90m   92[0m  [39m  foo:
â›” [0mğŸ—[3m[90m   93[0m  [39m    whelp bar
â›” [0mğŸ—[3m[90m   94[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mwhelp helps disambiguate cps callbacks at instantiation: compile failed[0m
â›” ğŸ—[3m[90m   97[0m  [39mblock:
â›” [0mğŸ—[3m[90m   98[0m  [39m  ## whelp helps disambiguate cps callbacks at instantiation
â›” [0mğŸ—[3m[90m   99[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  100[0m  [39m  type
â›” [0mğŸ—[3m[90m  101[0m  [39m    ContCall {.used.} = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  102[0m  [39m    MoreCall {.used.} = proc (a: float): float {.cps: Cont.}
â›” [0mğŸ—[3m[90m  103[0m  [39m  proc bar(a: float): float {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  104[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  105[0m  [39m    return a * 2.0
â›” [0mğŸ—[3m[90m  106[0m  [39m
â›” [0mğŸ—[3m[90m  107[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  108[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  109[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  110[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m  111[0m  [39m
â›” [0mğŸ—[3m[90m  112[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  113[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  114[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m  115[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m  116[0m  [39m
â›” [0mğŸ—[3m[90m  117[0m  [39m  foo:
â›” [0mğŸ—[3m[90m  118[0m  [39m    whelp(ContCall, bar)
â›” [0mğŸ—[3m[90m  119[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback in cps with natural syntax: compile failed[0m
â›” ğŸ—[3m[90m  122[0m  [39mblock:
â›” [0mğŸ—[3m[90m  123[0m  [39m  ## run a callback in cps with natural syntax
â›” [0mğŸ—[3m[90m  124[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  125[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  126[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  127[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  128[0m  [39m  else:
â›” [0mğŸ—[3m[90m  129[0m  [39m    type
â›” [0mğŸ—[3m[90m  130[0m  [39m      ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  131[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  132[0m  [39m    proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  133[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  134[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  135[0m  [39m      return a * 2
â›” [0mğŸ—[3m[90m  136[0m  [39m
â›” [0mğŸ—[3m[90m  137[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  138[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  139[0m  [39m      let x = c(4)
â›” [0mğŸ—[3m[90m  140[0m  [39m      check x == 8
â›” [0mğŸ—[3m[90m  141[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  142[0m  [39m
â›” [0mğŸ—[3m[90m  143[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  144[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  145[0m  [39m    check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback with no return value in cps: compile failed[0m
â›” ğŸ—[3m[90m  149[0m  [39mblock:
â›” [0mğŸ—[3m[90m  150[0m  [39m  ## run a callback with no return value in cps
â›” [0mğŸ—[3m[90m  151[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  152[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  153[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  154[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  155[0m  [39m  else:
â›” [0mğŸ—[3m[90m  156[0m  [39m    type
â›” [0mğŸ—[3m[90m  157[0m  [39m      ContCall = proc (a: int) {.cps: Cont.}
â›” [0mğŸ—[3m[90m  158[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  159[0m  [39m    proc bar(a: int) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  160[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  161[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  162[0m  [39m
â›” [0mğŸ—[3m[90m  163[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  164[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  165[0m  [39m      c(4)
â›” [0mğŸ—[3m[90m  166[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  167[0m  [39m
â›” [0mğŸ—[3m[90m  168[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  169[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  170[0m  [39m    check k[0m
ğŸŸ¢ [32mcallback illustration[0m
[3m[90m## [3m[97m9 tests  [0m          ğŸŸ¢5          â›”4
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 30_cc: c arc debug execute                                            3.0s
ğŸƒ 51_hooks_extended: c arc release execute                          
ğŸŸ¢ 25_compile_fail_wrapper: c arc release execute                        5.3s
ğŸƒ 51_hooks_extended: c orc release execute                          
ğŸŸ¢ 25_compile_fail_wrapper: c orc release execute                        5.3s
ğŸƒ 52_blocks_enabled: c arc debug execute                            
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t30_cc.nim
#24635/1 okay.
/run/user/1000/balls-nimcache-2203862776.c.debug.orc-24525/30_cc_24635_279354421858115172
#24635/2 fail!
[3m[90m## [3m[97mcalling convention[0m
ğŸŸ¢ [32msome different callback types[0m
ğŸŸ¢ [32mproduce callbacks from a symbol[0m
ğŸŸ¢ [32mproduce callbacks that match whelp types[0m
ğŸŸ¢ [32mexecute a callback with arguments[0m
â›” [1m[7m[48;2;255;255;255m[91mcallbacks run from inside cps run pass, tail, etc.: compile failed[0m
â›” ğŸ—[3m[90m   62[0m  [39mblock:
â›” [0mğŸ—[3m[90m   63[0m  [39m  ## callbacks run from inside cps run pass, tail, etc.
â›” [0mğŸ—[3m[90m   64[0m  [39m  var k = newKiller 7
â›” [0mğŸ—[3m[90m   65[0m  [39m  type
â›” [0mğŸ—[3m[90m   66[0m  [39m    ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m   67[0m  [39m  proc tail(c: Continuation; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   68[0m  [39m    d.mom = c
â›” [0mğŸ—[3m[90m   69[0m  [39m    step 3
â›” [0mğŸ—[3m[90m   70[0m  [39m    d
â›” [0mğŸ—[3m[90m   71[0m  [39m
â›” [0mğŸ—[3m[90m   72[0m  [39m  proc pass(c: Cont; d: Cont): Cont =
â›” [0mğŸ—[3m[90m   73[0m  [39m    step 4
â›” [0mğŸ—[3m[90m   74[0m  [39m    d
â›” [0mğŸ—[3m[90m   75[0m  [39m
â›” [0mğŸ—[3m[90m   76[0m  [39m  proc head(c: Cont): Cont =
â›” [0mğŸ—[3m[90m   77[0m  [39m    step 1
â›” [0mğŸ—[3m[90m   78[0m  [39m    c
â›” [0mğŸ—[3m[90m   79[0m  [39m
â›” [0mğŸ—[3m[90m   80[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   81[0m  [39m    noop()
â›” [0mğŸ—[3m[90m   82[0m  [39m    step 5
â›” [0mğŸ—[3m[90m   83[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m   84[0m  [39m
â›” [0mğŸ—[3m[90m   85[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m   86[0m  [39m    step 2
â›” [0mğŸ—[3m[90m   87[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m   88[0m  [39m    step 6
â›” [0mğŸ—[3m[90m   89[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m   90[0m  [39m    step 7
â›” [0mğŸ—[3m[90m   91[0m  [39m
â›” [0mğŸ—[3m[90m   92[0m  [39m  foo:
â›” [0mğŸ—[3m[90m   93[0m  [39m    whelp bar
â›” [0mğŸ—[3m[90m   94[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mwhelp helps disambiguate cps callbacks at instantiation: compile failed[0m
â›” ğŸ—[3m[90m   97[0m  [39mblock:
â›” [0mğŸ—[3m[90m   98[0m  [39m  ## whelp helps disambiguate cps callbacks at instantiation
â›” [0mğŸ—[3m[90m   99[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  100[0m  [39m  type
â›” [0mğŸ—[3m[90m  101[0m  [39m    ContCall {.used.} = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  102[0m  [39m    MoreCall {.used.} = proc (a: float): float {.cps: Cont.}
â›” [0mğŸ—[3m[90m  103[0m  [39m  proc bar(a: float): float {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  104[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  105[0m  [39m    return a * 2.0
â›” [0mğŸ—[3m[90m  106[0m  [39m
â›” [0mğŸ—[3m[90m  107[0m  [39m  proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  108[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  109[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  110[0m  [39m    return a * 2
â›” [0mğŸ—[3m[90m  111[0m  [39m
â›” [0mğŸ—[3m[90m  112[0m  [39m  proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  113[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  114[0m  [39m    var x = c(4)
â›” [0mğŸ—[3m[90m  115[0m  [39m    check x == 8
â›” [0mğŸ—[3m[90m  116[0m  [39m
â›” [0mğŸ—[3m[90m  117[0m  [39m  foo:
â›” [0mğŸ—[3m[90m  118[0m  [39m    whelp(ContCall, bar)
â›” [0mğŸ—[3m[90m  119[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback in cps with natural syntax: compile failed[0m
â›” ğŸ—[3m[90m  122[0m  [39mblock:
â›” [0mğŸ—[3m[90m  123[0m  [39m  ## run a callback in cps with natural syntax
â›” [0mğŸ—[3m[90m  124[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  125[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  126[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  127[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  128[0m  [39m  else:
â›” [0mğŸ—[3m[90m  129[0m  [39m    type
â›” [0mğŸ—[3m[90m  130[0m  [39m      ContCall = proc (a: int): int {.cps: Cont.}
â›” [0mğŸ—[3m[90m  131[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  132[0m  [39m    proc bar(a: int): int {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  133[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  134[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  135[0m  [39m      return a * 2
â›” [0mğŸ—[3m[90m  136[0m  [39m
â›” [0mğŸ—[3m[90m  137[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  138[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  139[0m  [39m      let x = c(4)
â›” [0mğŸ—[3m[90m  140[0m  [39m      check x == 8
â›” [0mğŸ—[3m[90m  141[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  142[0m  [39m
â›” [0mğŸ—[3m[90m  143[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  144[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  145[0m  [39m    check k[0m
â›” [1m[7m[48;2;255;255;255m[91mrun a callback with no return value in cps: compile failed[0m
â›” ğŸ—[3m[90m  149[0m  [39mblock:
â›” [0mğŸ—[3m[90m  150[0m  [39m  ## run a callback with no return value in cps
â›” [0mğŸ—[3m[90m  151[0m  [39m       ## Requires: Call operator support in compiler
â›” [0mğŸ—[3m[90m  152[0m  [39m       ## Note: Skip automatically enables when compiler supports this feature
â›” [0mğŸ—[3m[90m  153[0m  [39m  when not cpsCallOperatorSupported or defined(cpsNoCallOperator):
â›” [0mğŸ—[3m[90m  154[0m  [39m    skip "unsupported on nim " & NimVersion & " (see SKIPPED_TESTS_ANALYSIS.md)"
â›” [0mğŸ—[3m[90m  155[0m  [39m  else:
â›” [0mğŸ—[3m[90m  156[0m  [39m    type
â›” [0mğŸ—[3m[90m  157[0m  [39m      ContCall = proc (a: int) {.cps: Cont.}
â›” [0mğŸ—[3m[90m  158[0m  [39m    var k = newKiller 3
â›” [0mğŸ—[3m[90m  159[0m  [39m    proc bar(a: int) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  160[0m  [39m      noop()
â›” [0mğŸ—[3m[90m  161[0m  [39m      step 2
â›” [0mğŸ—[3m[90m  162[0m  [39m
â›” [0mğŸ—[3m[90m  163[0m  [39m    proc foo(c: ContCall) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  164[0m  [39m      step 1
â›” [0mğŸ—[3m[90m  165[0m  [39m      c(4)
â›” [0mğŸ—[3m[90m  166[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  167[0m  [39m
â›” [0mğŸ—[3m[90m  168[0m  [39m    foo:
â›” [0mğŸ—[3m[90m  169[0m  [39m      whelp bar
â›” [0mğŸ—[3m[90m  170[0m  [39m    check k[0m
ğŸŸ¢ [32mcallback illustration[0m
[3m[90m## [3m[97m9 tests  [0m          ğŸŸ¢5          â›”4
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 30_cc: c orc debug execute                                            3.1s
ğŸƒ 52_blocks_enabled: c orc debug execute                            
ğŸŸ¢ 50_hooks: c arc debug execute                                         3.8s
ğŸƒ 52_blocks_enabled: c arc release execute                          
ğŸŸ¢ 50_hooks: c orc debug execute                                         3.9s
ğŸƒ 52_blocks_enabled: c orc release execute                          
ğŸŸ¢ 40_ast: c arc debug execute                                           4.7s
ğŸƒ 52_blocks_skipped: c arc debug execute                            
ğŸŸ¢ 51_hooks_extended: c arc debug execute                                3.5s
ğŸƒ 52_blocks_skipped: c orc debug execute                            
ğŸŸ¢ 51_hooks_extended: c orc debug execute                                3.5s
ğŸƒ 52_blocks_skipped: c arc release execute                          
ğŸŸ¢ 40_ast: c orc debug execute                                           4.8s
ğŸƒ 52_blocks_skipped: c orc release execute                          
ğŸŸ¢ 30_cc: c arc release execute                                          5.8s
ğŸƒ 52_hooks_edge_cases: c arc debug execute                          
ğŸŸ¢ 30_cc: c orc release execute                                          5.8s
ğŸƒ 52_hooks_edge_cases: c orc debug execute                          
ğŸŸ¢ 52_blocks_enabled: c arc debug execute                                3.4s
ğŸƒ 52_hooks_edge_cases: c arc release execute                        
ğŸŸ¢ 52_blocks_enabled: c orc debug execute                                3.6s
ğŸƒ 52_hooks_edge_cases: c orc release execute                        
ğŸŸ¢ 50_hooks: c arc release execute                                       6.0s
ğŸƒ 53_hooks_state: c arc debug execute                               
ğŸŸ¢ 40_ast: c arc release execute                                         7.0s
ğŸƒ 53_hooks_state: c orc debug execute                               
ğŸŸ¢ 50_hooks: c orc release execute                                       6.1s
ğŸƒ 53_hooks_state: c arc release execute                             
ğŸŸ¢ 52_blocks_skipped: c arc debug execute                                2.8s
ğŸƒ 53_hooks_state: c orc release execute                             
ğŸŸ¢ 52_blocks_skipped: c orc debug execute                                2.8s
ğŸƒ 54_control_flow: c arc debug execute                              
ğŸŸ¢ 40_ast: c orc release execute                                         7.3s
ğŸƒ 54_control_flow: c orc debug execute                              
ğŸŸ¢ 51_hooks_extended: c arc release execute                              5.4s
ğŸƒ 54_control_flow: c arc release execute                            
ğŸŸ¢ 51_hooks_extended: c orc release execute                              5.4s
ğŸƒ 54_control_flow: c orc release execute                            
ğŸŸ¢ 52_hooks_edge_cases: c arc debug execute                              2.7s
ğŸƒ 55_dismiss: c arc debug execute                                   
ğŸŸ¢ 52_hooks_edge_cases: c orc debug execute                              2.7s
ğŸƒ 55_dismiss: c orc debug execute                                   
ğŸŸ¢ 52_blocks_skipped: c arc release execute                              4.2s
ğŸƒ 55_dismiss: c arc release execute                                 
ğŸŸ¢ 52_blocks_skipped: c orc release execute                              4.3s
ğŸƒ 55_dismiss: c orc release execute                                 
ğŸŸ¢ 53_hooks_state: c arc debug execute                                   2.6s
ğŸƒ 56_whelp: c arc debug execute                                     
ğŸŸ¢ 52_blocks_enabled: c arc release execute                              5.4s
ğŸƒ 56_whelp: c orc debug execute                                     
ğŸŸ¢ 53_hooks_state: c orc debug execute                                   2.7s
ğŸƒ 56_whelp: c arc release execute                                   
ğŸŸ¢ 52_hooks_edge_cases: c arc release execute                            4.0s
ğŸƒ 56_whelp: c orc release execute                                   
ğŸŸ¢ 52_blocks_enabled: c orc release execute                              5.5s
ğŸƒ 57_integration: c arc debug execute                               
ğŸŸ¢ 52_hooks_edge_cases: c orc release execute                            4.1s
ğŸƒ 57_integration: c orc debug execute                               
ğŸŸ¢ 55_dismiss: c arc debug execute                                       2.8s
ğŸƒ 57_integration: c arc release execute                             
ğŸŸ¢ 54_control_flow: c arc debug execute                                  3.4s
ğŸƒ 57_integration: c orc release execute                             
ğŸŸ¢ 54_control_flow: c orc debug execute                                  3.4s
ğŸƒ 58_defers: c arc debug execute                                    
ğŸŸ¢ 53_hooks_state: c arc release execute                                 3.9s
ğŸƒ 58_defers: c orc debug execute                                    
ğŸŸ¢ 55_dismiss: c orc debug execute                                       3.0s
ğŸƒ 58_defers: c arc release execute                                  
ğŸŸ¢ 53_hooks_state: c orc release execute                                 4.0s
ğŸƒ 58_defers: c orc release execute                                  
ğŸŸ¢ 56_whelp: c arc debug execute                                         2.7s
ğŸƒ 60_returns: c arc debug execute                                   
ğŸŸ¢ 56_whelp: c orc debug execute                                         2.8s
ğŸƒ 60_returns: c orc debug execute                                   
ğŸŸ¢ 54_control_flow: c arc release execute                                4.8s
ğŸƒ 60_returns: c arc release execute                                 
ğŸŸ¢ 54_control_flow: c orc release execute                                5.1s
ğŸƒ 60_returns: c orc release execute                                 
ğŸŸ¢ 55_dismiss: c arc release execute                                     4.3s
ğŸƒ 61_returns_extended: c arc debug execute                          
ğŸŸ¢ 55_dismiss: c orc release execute                                     4.5s
ğŸƒ 61_returns_extended: c orc debug execute                          
ğŸŸ¢ 56_whelp: c arc release execute                                       4.1s
ğŸƒ 61_returns_extended: c arc release execute                        
ğŸŸ¢ 57_integration: c arc debug execute                                   4.0s
ğŸƒ 61_returns_extended: c orc release execute                        
ğŸŸ¢ 56_whelp: c orc release execute                                       4.2s
ğŸƒ 62_returns_values: c arc debug execute                            
ğŸŸ¢ 58_defers: c arc debug execute                                        3.2s
ğŸƒ 62_returns_values: c orc debug execute                            
ğŸŸ¢ 57_integration: c orc debug execute                                   4.0s
ğŸƒ 62_returns_values: c arc release execute                          
ğŸŸ¢ 58_defers: c orc debug execute                                        3.2s
ğŸƒ 62_returns_values: c orc release execute                          
ğŸŸ¢ 58_defers: c arc release execute                                      4.8s
ğŸƒ 70_locals: c arc debug execute                                    
ğŸŸ¢ 57_integration: c arc release execute                                 5.5s
ğŸƒ 70_locals: c orc debug execute                                    
ğŸŸ¢ 58_defers: c orc release execute                                      4.9s
ğŸƒ 70_locals: c arc release execute                                  
ğŸŸ¢ 57_integration: c orc release execute                                 5.9s
ğŸƒ 70_locals: c orc release execute                                  
ğŸŸ¢ 62_returns_values: c arc debug execute                                2.9s
ğŸƒ 71_locals_extended: c arc debug execute                           
ğŸŸ¢ 62_returns_values: c orc debug execute                                3.1s
ğŸƒ 71_locals_extended: c orc debug execute                           
ğŸŸ¢ 60_returns: c arc debug execute                                       5.9s
ğŸƒ 71_locals_extended: c arc release execute                         
ğŸŸ¢ 60_returns: c orc debug execute                                       5.8s
ğŸƒ 71_locals_extended: c orc release execute                         
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t70_locals.nim
#24627/1 fail!
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 70_locals: c arc release execute                                      2.0s
ğŸƒ 72_locals_scope: c arc debug execute                              
ğŸŸ¢ 62_returns_values: c arc release execute                              4.4s
ğŸƒ 72_locals_scope: c orc debug execute                              
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t70_locals.nim
#24624/1 fail!
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 70_locals: c orc release execute                                      2.1s
ğŸƒ 72_locals_scope: c arc release execute                            
ğŸŸ¢ 62_returns_values: c orc release execute                              4.6s
ğŸƒ 72_locals_scope: c orc release execute                            
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t70_locals.nim
#24636/1 fail!
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 70_locals: c arc debug execute                                        3.2s
ğŸƒ 73_parameters: c arc debug execute                                
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t70_locals.nim
#24634/1 fail!
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t70_locals.nim(431, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 70_locals: c orc debug execute                                        3.2s
ğŸƒ 73_parameters: c orc debug execute                                
ğŸŸ¢ 71_locals_extended: c arc debug execute                               2.7s
ğŸƒ 73_parameters: c arc release execute                              
ğŸŸ¢ 71_locals_extended: c orc debug execute                               2.8s
ğŸƒ 73_parameters: c orc release execute                              
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t61_returns_extended.nim
#24623/1 okay.
/run/user/1000/balls-nimcache-2761765652.c.debug.arc-24525/61_returns_extended_24623_-7357520050125701102
#24623/2 fail!
[3m[90m## [3m[97mreturns extended[0m
ğŸ”´ [31mreturn in if branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## return in if branch
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m  check k[0m
ğŸ”´ [31mreturn in elif branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   23[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  ## return in elif branch
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   26[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   27[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   28[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m   29[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m   30[0m  [39m    elif x == 0:
ğŸ”´ [0mğŸ—[3m[90m   31[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   32[0m  [39m      return 0
ğŸ”´ [0mğŸ—[3m[90m   33[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   34[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   35[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m   36[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   37[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   38[0m  [39m    let result = bar(0)
ğŸ”´ [0mğŸ—[3m[90m   39[0m  [39m    check result == 0
ğŸ”´ [0mğŸ—[3m[90m   40[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   41[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   42[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in else branch[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(80) foo
ğŸ”´ [31mreturn in case branch: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   63[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   64[0m  [39m  ## return in case branch
ğŸ”´ [0mğŸ—[3m[90m   65[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m   66[0m  [39m  proc bar(x: int): string {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   67[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   68[0m  [39m    case x
ğŸ”´ [0mğŸ—[3m[90m   69[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m   70[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   71[0m  [39m      return "one"
ğŸ”´ [0mğŸ—[3m[90m   72[0m  [39m    of 2:
ğŸ”´ [0mğŸ—[3m[90m   73[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   74[0m  [39m      return "two"
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m      return "other"
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m    let result = bar(2)
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    check result == "two"
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m  check k[0m
ğŸ”´ [31mreturn early in while loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   86[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m  ## return early in while loop
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m    var i = 0
ğŸ”´ [0mğŸ—[3m[90m   92[0m  [39m    while i < limit:
ğŸ”´ [0mğŸ—[3m[90m   93[0m  [39m      inc i
ğŸ”´ [0mğŸ—[3m[90m   94[0m  [39m      if i == 3:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m  check k[0m
ğŸ”´ [31mreturn in for loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  107[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  ## return in for loop
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m    for i in 0 .. limit:
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m      if i == 5:
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  115[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m  116[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  117[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  118[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  119[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  120[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  121[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  122[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  123[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  124[0m  [39m  check k[0m
ğŸ”´ [31mreturn in try block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  126[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  127[0m  [39m  ## return in try block
ğŸ”´ [0mğŸ—[3m[90m  128[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  129[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  130[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  131[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  132[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  133[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m  134[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  135[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  136[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  137[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  138[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  139[0m  [39m    let result = bar(4)
ğŸ”´ [0mğŸ—[3m[90m  140[0m  [39m    check result == 8
ğŸ”´ [0mğŸ—[3m[90m  141[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  142[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  143[0m  [39m  check k[0m
ğŸ”´ [31mreturn in except handler: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  145[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  146[0m  [39m  ## return in except handler
ğŸ”´ [0mğŸ—[3m[90m  147[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  148[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  149[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  150[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  151[0m  [39m      raise ValueError.newException "error"
ğŸ”´ [0mğŸ—[3m[90m  152[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m      return x * 3
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m    let result = bar(3)
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m    check result == 9
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in finally doesn't suppress exception[0m
ğŸŸ¢ [32mmultiple return paths with different types[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(230) foo
ğŸ”´ [31mnested return in if: [3m[97mexpected step 2 but hit 3[0m[0m
ğŸ”´ ğŸ—[3m[90m  214[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  ## nested return in if
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m  proc outer(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m    let result = inner(x)
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m    return result
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m    let result = outer(5)
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  232[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  233[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  234[0m  [39m  check k[0m
ğŸ”´ [31mreturn with type conversion: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  236[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  ## return with type conversion
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      return x.Natural.int
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m    let result = bar(42)
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(267) outer
ğŸ”´ [31mvoid continuation returning: [3m[97mexpected step 3 but hit 1[0m[0m
ğŸ”´ ğŸ—[3m[90m  254[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  ## void continuation returning
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  var call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m  proc inner() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    inc call_count
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    return
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m  proc outer() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m  outer()
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  check "void return works":
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m    call_count == 2
ğŸ”´ [0mğŸ—[3m[90m  272[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn of tuple from continuation[0m
ğŸŸ¢ [32mreturn with object construction[0m
ğŸ”´ [31mreturn early skips rest of function: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  314[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m  ## return early skips rest of function
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  var executed_after_return = false
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  323[0m  [39m    executed_after_return = true
ğŸ”´ [0mğŸ—[3m[90m  324[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  325[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  326[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  327[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  328[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  329[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  330[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  331[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  332[0m  [39m  check "code after return not executed":
ğŸ”´ [0mğŸ—[3m[90m  333[0m  [39m    not executed_after_return
ğŸ”´ [0mğŸ—[3m[90m  334[0m  [39m  check k[0m
ğŸ”´ [31mreturn in nested block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  337[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  338[0m  [39m  ## return in nested block
ğŸ”´ [0mğŸ—[3m[90m  339[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  340[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  341[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m    block outer:
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m      block inner:
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m        return x + 1
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    return -2
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m    check result == 6
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m  check k[0m
[3m[90m## [3m[97m17 tests  [0m          ğŸŸ¢5      ğŸ”´12    
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 61_returns_extended: c arc debug execute                              7.1s
ğŸƒ 80_exceptions_extended: c arc debug execute                       
ğŸŸ¢ 60_returns: c arc release execute                                     7.9s
ğŸƒ 80_exceptions_extended: c orc debug execute                       
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t61_returns_extended.nim
#24629/1 okay.
/run/user/1000/balls-nimcache-2761765652.c.debug.orc-24525/61_returns_extended_24629_696478721523774681
#24629/2 fail!
[3m[90m## [3m[97mreturns extended[0m
ğŸ”´ [31mreturn in if branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## return in if branch
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m  check k[0m
ğŸ”´ [31mreturn in elif branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   23[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  ## return in elif branch
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   26[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   27[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   28[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m   29[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m   30[0m  [39m    elif x == 0:
ğŸ”´ [0mğŸ—[3m[90m   31[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   32[0m  [39m      return 0
ğŸ”´ [0mğŸ—[3m[90m   33[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   34[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   35[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m   36[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   37[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   38[0m  [39m    let result = bar(0)
ğŸ”´ [0mğŸ—[3m[90m   39[0m  [39m    check result == 0
ğŸ”´ [0mğŸ—[3m[90m   40[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   41[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   42[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in else branch[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(80) foo
ğŸ”´ [31mreturn in case branch: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   63[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   64[0m  [39m  ## return in case branch
ğŸ”´ [0mğŸ—[3m[90m   65[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m   66[0m  [39m  proc bar(x: int): string {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   67[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   68[0m  [39m    case x
ğŸ”´ [0mğŸ—[3m[90m   69[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m   70[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   71[0m  [39m      return "one"
ğŸ”´ [0mğŸ—[3m[90m   72[0m  [39m    of 2:
ğŸ”´ [0mğŸ—[3m[90m   73[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   74[0m  [39m      return "two"
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m      return "other"
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m    let result = bar(2)
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    check result == "two"
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m  check k[0m
ğŸ”´ [31mreturn early in while loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   86[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m  ## return early in while loop
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m    var i = 0
ğŸ”´ [0mğŸ—[3m[90m   92[0m  [39m    while i < limit:
ğŸ”´ [0mğŸ—[3m[90m   93[0m  [39m      inc i
ğŸ”´ [0mğŸ—[3m[90m   94[0m  [39m      if i == 3:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m  check k[0m
ğŸ”´ [31mreturn in for loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  107[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  ## return in for loop
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m    for i in 0 .. limit:
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m      if i == 5:
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  115[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m  116[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  117[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  118[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  119[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  120[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  121[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  122[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  123[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  124[0m  [39m  check k[0m
ğŸ”´ [31mreturn in try block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  126[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  127[0m  [39m  ## return in try block
ğŸ”´ [0mğŸ—[3m[90m  128[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  129[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  130[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  131[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  132[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  133[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m  134[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  135[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  136[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  137[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  138[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  139[0m  [39m    let result = bar(4)
ğŸ”´ [0mğŸ—[3m[90m  140[0m  [39m    check result == 8
ğŸ”´ [0mğŸ—[3m[90m  141[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  142[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  143[0m  [39m  check k[0m
ğŸ”´ [31mreturn in except handler: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  145[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  146[0m  [39m  ## return in except handler
ğŸ”´ [0mğŸ—[3m[90m  147[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  148[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  149[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  150[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  151[0m  [39m      raise ValueError.newException "error"
ğŸ”´ [0mğŸ—[3m[90m  152[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m      return x * 3
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m    let result = bar(3)
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m    check result == 9
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in finally doesn't suppress exception[0m
ğŸŸ¢ [32mmultiple return paths with different types[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(230) foo
ğŸ”´ [31mnested return in if: [3m[97mexpected step 2 but hit 3[0m[0m
ğŸ”´ ğŸ—[3m[90m  214[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  ## nested return in if
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m  proc outer(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m    let result = inner(x)
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m    return result
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m    let result = outer(5)
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  232[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  233[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  234[0m  [39m  check k[0m
ğŸ”´ [31mreturn with type conversion: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  236[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  ## return with type conversion
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      return x.Natural.int
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m    let result = bar(42)
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(267) outer
ğŸ”´ [31mvoid continuation returning: [3m[97mexpected step 3 but hit 1[0m[0m
ğŸ”´ ğŸ—[3m[90m  254[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  ## void continuation returning
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  var call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m  proc inner() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    inc call_count
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    return
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m  proc outer() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m  outer()
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  check "void return works":
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m    call_count == 2
ğŸ”´ [0mğŸ—[3m[90m  272[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn of tuple from continuation[0m
ğŸŸ¢ [32mreturn with object construction[0m
ğŸ”´ [31mreturn early skips rest of function: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  314[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m  ## return early skips rest of function
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  var executed_after_return = false
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  323[0m  [39m    executed_after_return = true
ğŸ”´ [0mğŸ—[3m[90m  324[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  325[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  326[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  327[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  328[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  329[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  330[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  331[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  332[0m  [39m  check "code after return not executed":
ğŸ”´ [0mğŸ—[3m[90m  333[0m  [39m    not executed_after_return
ğŸ”´ [0mğŸ—[3m[90m  334[0m  [39m  check k[0m
ğŸ”´ [31mreturn in nested block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  337[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  338[0m  [39m  ## return in nested block
ğŸ”´ [0mğŸ—[3m[90m  339[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  340[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  341[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m    block outer:
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m      block inner:
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m        return x + 1
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    return -2
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m    check result == 6
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m  check k[0m
[3m[90m## [3m[97m17 tests  [0m          ğŸŸ¢5      ğŸ”´12    
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 61_returns_extended: c orc debug execute                              7.0s
ğŸƒ 80_exceptions_extended: c arc release execute                     
ğŸŸ¢ 60_returns: c orc release execute                                     8.2s
ğŸƒ 80_exceptions_extended: c orc release execute                     
ğŸŸ¢ 72_locals_scope: c arc debug execute                                  2.9s
ğŸƒ 80_try1: c arc debug execute                                      
ğŸŸ¢ 72_locals_scope: c orc debug execute                                  2.9s
ğŸƒ 80_try1: c orc debug execute                                      
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t80_try1.nim
#24627/1 fail!
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try1: c arc debug execute                                       768.6ms
ğŸƒ 80_try1: c arc release execute                                    
ğŸŸ¢ 73_parameters: c arc debug execute                                    2.8s
ğŸƒ 80_try1: c orc release execute                                    
ğŸŸ¢ 71_locals_extended: c arc release execute                             4.0s
ğŸƒ 80_try2: c arc debug execute                                      
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t80_try1.nim
#24635/1 fail!
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try1: c orc debug execute                                       753.5ms
ğŸƒ 80_try2: c orc debug execute                                      
ğŸŸ¢ 71_locals_extended: c orc release execute                             4.2s
ğŸƒ 80_try2: c arc release execute                                    
ğŸŸ¢ 73_parameters: c orc debug execute                                    3.0s
ğŸƒ 80_try2: c orc release execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t80_try1.nim
#24627/1 fail!
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try1: c arc release execute                                     732.3ms
ğŸƒ 85_callbacks: c arc debug execute                                 
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t80_try1.nim
#24636/1 fail!
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try1.nim(274, 6) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try1: c orc release execute                                     746.4ms
ğŸƒ 85_callbacks: c orc debug execute                                 
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t80_try2.nim
#24631/1 fail!
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try2: c arc debug execute                                       783.8ms
ğŸƒ 85_callbacks: c arc release execute                               
ğŸŸ¢ 72_locals_scope: c arc release execute                                4.1s
ğŸƒ 85_callbacks: c orc release execute                               
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t80_try2.nim
#24635/1 fail!
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try2: c orc debug execute                                       770.7ms
ğŸƒ 90_exprs1: c arc debug execute                                    
ğŸŸ¢ 72_locals_scope: c orc release execute                                4.3s
ğŸƒ 90_exprs1: c orc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t80_try2.nim
#24638/1 fail!
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try2: c arc release execute                                     792.9ms
ğŸƒ 90_exprs1: c arc release execute                                  
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t80_try2.nim
#24634/1 fail!
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: invalid indentation
/home/adavidoff/git/cps/tests/t80_try2.nim(161, 5) Error: expression expected, but found 'keyword else'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 80_try2: c orc release execute                                     756.5ms
ğŸƒ 90_exprs1: c orc release execute                                  
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t61_returns_extended.nim
#24632/1 okay.
/run/user/1000/balls-nimcache-2761765652.c.release.arc-24525/61_returns_extended_24632_7059338631598405771
#24632/2 fail!
[3m[90m## [3m[97mreturns extended[0m
ğŸ”´ [31mreturn in if branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## return in if branch
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m  check k[0m
ğŸ”´ [31mreturn in elif branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   23[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  ## return in elif branch
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   26[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   27[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   28[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m   29[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m   30[0m  [39m    elif x == 0:
ğŸ”´ [0mğŸ—[3m[90m   31[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   32[0m  [39m      return 0
ğŸ”´ [0mğŸ—[3m[90m   33[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   34[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   35[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m   36[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   37[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   38[0m  [39m    let result = bar(0)
ğŸ”´ [0mğŸ—[3m[90m   39[0m  [39m    check result == 0
ğŸ”´ [0mğŸ—[3m[90m   40[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   41[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   42[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in else branch[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(80) foo
ğŸ”´ [31mreturn in case branch: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   63[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   64[0m  [39m  ## return in case branch
ğŸ”´ [0mğŸ—[3m[90m   65[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m   66[0m  [39m  proc bar(x: int): string {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   67[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   68[0m  [39m    case x
ğŸ”´ [0mğŸ—[3m[90m   69[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m   70[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   71[0m  [39m      return "one"
ğŸ”´ [0mğŸ—[3m[90m   72[0m  [39m    of 2:
ğŸ”´ [0mğŸ—[3m[90m   73[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   74[0m  [39m      return "two"
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m      return "other"
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m    let result = bar(2)
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    check result == "two"
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m  check k[0m
ğŸ”´ [31mreturn early in while loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   86[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m  ## return early in while loop
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m    var i = 0
ğŸ”´ [0mğŸ—[3m[90m   92[0m  [39m    while i < limit:
ğŸ”´ [0mğŸ—[3m[90m   93[0m  [39m      inc i
ğŸ”´ [0mğŸ—[3m[90m   94[0m  [39m      if i == 3:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m  check k[0m
ğŸ”´ [31mreturn in for loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  107[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  ## return in for loop
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m    for i in 0 .. limit:
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m      if i == 5:
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  115[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m  116[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  117[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  118[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  119[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  120[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  121[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  122[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  123[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  124[0m  [39m  check k[0m
ğŸ”´ [31mreturn in try block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  126[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  127[0m  [39m  ## return in try block
ğŸ”´ [0mğŸ—[3m[90m  128[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  129[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  130[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  131[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  132[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  133[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m  134[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  135[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  136[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  137[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  138[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  139[0m  [39m    let result = bar(4)
ğŸ”´ [0mğŸ—[3m[90m  140[0m  [39m    check result == 8
ğŸ”´ [0mğŸ—[3m[90m  141[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  142[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  143[0m  [39m  check k[0m
ğŸ”´ [31mreturn in except handler: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  145[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  146[0m  [39m  ## return in except handler
ğŸ”´ [0mğŸ—[3m[90m  147[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  148[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  149[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  150[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  151[0m  [39m      raise ValueError.newException "error"
ğŸ”´ [0mğŸ—[3m[90m  152[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m      return x * 3
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m    let result = bar(3)
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m    check result == 9
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in finally doesn't suppress exception[0m
ğŸŸ¢ [32mmultiple return paths with different types[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(230) foo
ğŸ”´ [31mnested return in if: [3m[97mexpected step 2 but hit 3[0m[0m
ğŸ”´ ğŸ—[3m[90m  214[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  ## nested return in if
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m  proc outer(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m    let result = inner(x)
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m    return result
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m    let result = outer(5)
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  232[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  233[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  234[0m  [39m  check k[0m
ğŸ”´ [31mreturn with type conversion: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  236[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  ## return with type conversion
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      return x.Natural.int
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m    let result = bar(42)
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(267) outer
ğŸ”´ [31mvoid continuation returning: [3m[97mexpected step 3 but hit 1[0m[0m
ğŸ”´ ğŸ—[3m[90m  254[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  ## void continuation returning
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  var call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m  proc inner() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    inc call_count
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    return
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m  proc outer() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m  outer()
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  check "void return works":
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m    call_count == 2
ğŸ”´ [0mğŸ—[3m[90m  272[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn of tuple from continuation[0m
ğŸŸ¢ [32mreturn with object construction[0m
ğŸ”´ [31mreturn early skips rest of function: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  314[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m  ## return early skips rest of function
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  var executed_after_return = false
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  323[0m  [39m    executed_after_return = true
ğŸ”´ [0mğŸ—[3m[90m  324[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  325[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  326[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  327[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  328[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  329[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  330[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  331[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  332[0m  [39m  check "code after return not executed":
ğŸ”´ [0mğŸ—[3m[90m  333[0m  [39m    not executed_after_return
ğŸ”´ [0mğŸ—[3m[90m  334[0m  [39m  check k[0m
ğŸ”´ [31mreturn in nested block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  337[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  338[0m  [39m  ## return in nested block
ğŸ”´ [0mğŸ—[3m[90m  339[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  340[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  341[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m    block outer:
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m      block inner:
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m        return x + 1
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    return -2
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m    check result == 6
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m  check k[0m
[3m[90m## [3m[97m17 tests  [0m          ğŸŸ¢5      ğŸ”´12    
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 61_returns_extended: c arc release execute                            9.7s
ğŸƒ 90_exprs2: c arc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t61_returns_extended.nim
#24633/1 okay.
/run/user/1000/balls-nimcache-2761765652.c.release.orc-24525/61_returns_extended_24633_-6677557866687828692
#24633/2 fail!
[3m[90m## [3m[97mreturns extended[0m
ğŸ”´ [31mreturn in if branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## return in if branch
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m  check k[0m
ğŸ”´ [31mreturn in elif branch: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   23[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  ## return in elif branch
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   26[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   27[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   28[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m   29[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m   30[0m  [39m    elif x == 0:
ğŸ”´ [0mğŸ—[3m[90m   31[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   32[0m  [39m      return 0
ğŸ”´ [0mğŸ—[3m[90m   33[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   34[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   35[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m   36[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   37[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   38[0m  [39m    let result = bar(0)
ğŸ”´ [0mğŸ—[3m[90m   39[0m  [39m    check result == 0
ğŸ”´ [0mğŸ—[3m[90m   40[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   41[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   42[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in else branch[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(80) foo
ğŸ”´ [31mreturn in case branch: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   63[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   64[0m  [39m  ## return in case branch
ğŸ”´ [0mğŸ—[3m[90m   65[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m   66[0m  [39m  proc bar(x: int): string {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   67[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   68[0m  [39m    case x
ğŸ”´ [0mğŸ—[3m[90m   69[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m   70[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m   71[0m  [39m      return "one"
ğŸ”´ [0mğŸ—[3m[90m   72[0m  [39m    of 2:
ğŸ”´ [0mğŸ—[3m[90m   73[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m   74[0m  [39m      return "two"
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m      return "other"
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m    let result = bar(2)
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    check result == "two"
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m  check k[0m
ğŸ”´ [31mreturn early in while loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   86[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m  ## return early in while loop
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m    var i = 0
ğŸ”´ [0mğŸ—[3m[90m   92[0m  [39m    while i < limit:
ğŸ”´ [0mğŸ—[3m[90m   93[0m  [39m      inc i
ğŸ”´ [0mğŸ—[3m[90m   94[0m  [39m      if i == 3:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m  check k[0m
ğŸ”´ [31mreturn in for loop: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  107[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  ## return in for loop
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m  proc bar(limit: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m    for i in 0 .. limit:
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m      if i == 5:
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  115[0m  [39m        return i
ğŸ”´ [0mğŸ—[3m[90m  116[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  117[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  118[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  119[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  120[0m  [39m    let result = bar(10)
ğŸ”´ [0mğŸ—[3m[90m  121[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  122[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  123[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  124[0m  [39m  check k[0m
ğŸ”´ [31mreturn in try block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  126[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  127[0m  [39m  ## return in try block
ğŸ”´ [0mğŸ—[3m[90m  128[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  129[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  130[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  131[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  132[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  133[0m  [39m      return x * 2
ğŸ”´ [0mğŸ—[3m[90m  134[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  135[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  136[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  137[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  138[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  139[0m  [39m    let result = bar(4)
ğŸ”´ [0mğŸ—[3m[90m  140[0m  [39m    check result == 8
ğŸ”´ [0mğŸ—[3m[90m  141[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  142[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  143[0m  [39m  check k[0m
ğŸ”´ [31mreturn in except handler: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  145[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  146[0m  [39m  ## return in except handler
ğŸ”´ [0mğŸ—[3m[90m  147[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  148[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  149[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  150[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  151[0m  [39m      raise ValueError.newException "error"
ğŸ”´ [0mğŸ—[3m[90m  152[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m      return x * 3
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m    except:
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m    let result = bar(3)
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m    check result == 9
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn in finally doesn't suppress exception[0m
ğŸŸ¢ [32mmultiple return paths with different types[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(230) foo
ğŸ”´ [31mnested return in if: [3m[97mexpected step 2 but hit 3[0m[0m
ğŸ”´ ğŸ—[3m[90m  214[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  ## nested return in if
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m  proc outer(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m    let result = inner(x)
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m    return result
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m    let result = outer(5)
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  232[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  233[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  234[0m  [39m  check k[0m
ğŸ”´ [31mreturn with type conversion: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  236[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  ## return with type conversion
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      return x.Natural.int
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m    let result = bar(42)
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t61_returns_extended.nim(267) outer
ğŸ”´ [31mvoid continuation returning: [3m[97mexpected step 3 but hit 1[0m[0m
ğŸ”´ ğŸ—[3m[90m  254[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  ## void continuation returning
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  var call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m  proc inner() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    inc call_count
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    return
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m  proc outer() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  call_count = 0
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m  outer()
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  check "void return works":
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m    call_count == 2
ğŸ”´ [0mğŸ—[3m[90m  272[0m  [39m  check k[0m
ğŸŸ¢ [32mreturn of tuple from continuation[0m
ğŸŸ¢ [32mreturn with object construction[0m
ğŸ”´ [31mreturn early skips rest of function: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  314[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m  ## return early skips rest of function
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  var executed_after_return = false
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m    if x > 0:
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m      return x
ğŸ”´ [0mğŸ—[3m[90m  323[0m  [39m    executed_after_return = true
ğŸ”´ [0mğŸ—[3m[90m  324[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  325[0m  [39m    return -1
ğŸ”´ [0mğŸ—[3m[90m  326[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  327[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  328[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  329[0m  [39m    check result == 5
ğŸ”´ [0mğŸ—[3m[90m  330[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  331[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  332[0m  [39m  check "code after return not executed":
ğŸ”´ [0mğŸ—[3m[90m  333[0m  [39m    not executed_after_return
ğŸ”´ [0mğŸ—[3m[90m  334[0m  [39m  check k[0m
ğŸ”´ [31mreturn in nested block: [3m[97mmisused; 1 uses, expected 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  337[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  338[0m  [39m  ## return in nested block
ğŸ”´ [0mğŸ—[3m[90m  339[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  340[0m  [39m  proc bar(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  341[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m    block outer:
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m      block inner:
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m        step 1
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m        return x + 1
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m      return -1
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    return -2
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m    let result = bar(5)
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m    check result == 6
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m  check k[0m
[3m[90m## [3m[97m17 tests  [0m          ğŸŸ¢5      ğŸ”´12    
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 61_returns_extended: c orc release execute                           10.0s
ğŸƒ 90_exprs2: c orc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t85_callbacks.nim
#24631/1 fail!
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps/environment.nim(491, 16) Error: type mismatch:
 got 'cps:use_callback() env' for 'dealloc(Cont(continuation), cps:use_callback() env_50337997)' [object declared in /home/adavidoff/git/cps/cps/ast.nim(520, 29)]
 but expected 'cps:use_callback() env = ref cps:use_callback() env:ObjectType' [object declared in /home/adavidoff/git/cps/cps/ast.nim(520, 29)]
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps.nim(239, 41) Error: inconsistent typing for reintroduced symbol 'continuation': previous type was: cps:use_callback() env; new type is: cps:use_callback() env
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps.nim(200, 18) Error: undeclared field: 'frames'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 85_callbacks: c arc release execute                                   1.1s
ğŸƒ 90_exprs2: c arc release execute                                  
ğŸŸ¢ 73_parameters: c arc release execute                                  4.3s
ğŸƒ 90_exprs2: c orc release execute                                  
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t85_callbacks.nim
#24624/1 fail!
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps/environment.nim(491, 16) Error: type mismatch:
 got 'cps:use_callback() env' for 'dealloc(Cont(continuation), cps:use_callback() env_50338280)' [object declared in /home/adavidoff/git/cps/cps/ast.nim(520, 29)]
 but expected 'cps:use_callback() env = ref cps:use_callback() env:ObjectType' [object declared in /home/adavidoff/git/cps/cps/ast.nim(520, 29)]
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps.nim(239, 41) Error: inconsistent typing for reintroduced symbol 'continuation': previous type was: cps:use_callback() env; new type is: cps:use_callback() env
/home/adavidoff/git/cps/tests/t85_callbacks.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 20) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t85_callbacks.nim(124, 5) template/generic instantiation of `cpsFlattenExpr` from here
/home/adavidoff/git/cps/cps.nim(200, 18) Error: undeclared field: 'frames'
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 85_callbacks: c orc release execute                                   1.1s
ğŸƒ 90_exprs3: c arc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t90_exprs3.nim
#24624/1 fail!
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(39, 5) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 90_exprs3: c arc debug execute                                     180.8ms
ğŸƒ 90_exprs3: c orc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t90_exprs3.nim
#24624/1 fail!
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(39, 5) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 90_exprs3: c orc debug execute                                     177.7ms
ğŸƒ 90_exprs3: c arc release execute                                  
ğŸŸ¢ 73_parameters: c orc release execute                                  4.4s
ğŸƒ 90_exprs3: c orc release execute                                  
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t90_exprs3.nim
#24624/1 fail!
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(39, 5) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 90_exprs3: c arc release execute                                   164.6ms
ğŸƒ 90_exprs4: c arc debug execute                                    
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t90_exprs3.nim
#24625/1 fail!
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(31, 4) Error: invalid indentation
/home/adavidoff/git/cps/tests/t90_exprs3.nim(39, 5) Error: invalid indentation
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 90_exprs3: c orc release execute                                   179.7ms
ğŸƒ 90_exprs4: c orc debug execute                                    
ğŸŸ¢ 80_exceptions_extended: c arc debug execute                           4.8s
ğŸƒ 90_exprs4: c arc release execute                                  
ğŸŸ¢ 80_exceptions_extended: c orc debug execute                           4.8s
ğŸƒ 90_exprs4: c orc release execute                                  
ğŸŸ¢ 90_exprs2: c arc debug execute                                        3.3s
ğŸƒ 90_exprs5: c arc debug execute                                    
ğŸŸ¢ 90_exprs1: c arc debug execute                                        3.8s
ğŸƒ 90_exprs5: c orc debug execute                                    
ğŸŸ¢ 90_exprs1: c orc debug execute                                        3.8s
ğŸƒ 90_exprs5: c arc release execute                                  
ğŸŸ¢ 90_exprs2: c orc debug execute                                        3.3s
ğŸƒ 90_exprs5: c orc release execute                                  
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t85_callbacks.nim
#24627/1 okay.
/run/user/1000/balls-nimcache-2436058822.c.debug.arc-24525/85_callbacks_24627_-6919409059708106168
#24627/2 fail!
[3m[90m## [3m[97mcallbacks[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(13) bar
ğŸ”´ [31mcallback return type Continuation: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## callback return type Continuation
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    Callback = proc (): Continuation
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m  proc bar(cb: Callback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m    let c = cb()
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    trampoline c
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  proc callback_factory(): Callback =
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m    result = proc (): Continuation =
ğŸ”´ [0mğŸ—[3m[90m   22[0m  [39m      whelp foo()
ğŸ”´ [0mğŸ—[3m[90m   23[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  bar(callback_factory())
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  check k[0m
ğŸŸ¢ [32mcallback with int return type[0m
ğŸŸ¢ [32mcallback with arguments[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(84) bar
ğŸ”´ [31mcallback capturing closure variable: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   74[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m  ## callback capturing closure variable
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m  var captured = 10
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m    ClosureCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m  proc bar(cb: ClosureCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m    let result = cb()
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   85[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   86[0m  [39m  proc create_callback(): ClosureCallback =
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m      captured
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m  bar(create_callback())
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(104) bar
ğŸ”´ [31mcallback with mutable closure: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   94[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m  ## callback with mutable closure
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m  var counter = 0
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m    MutableCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc bar(cb: MutableCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    let val1 = cb()
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m    let val2 = cb()
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m    check val1 == 1
ğŸ”´ [0mğŸ—[3m[90m  106[0m  [39m    check val2 == 2
ğŸ”´ [0mğŸ—[3m[90m  107[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  proc create_callback(): MutableCallback =
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m      inc counter
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m      counter
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m  bar(create_callback())
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mnested callback definition: compile failed[0m
â›” ğŸ—[3m[90m  118[0m  [39mblock:
â›” [0mğŸ—[3m[90m  119[0m  [39m  ## nested callback definition
â›” [0mğŸ—[3m[90m  120[0m  [39m  var k = newKiller 3
â›” [0mğŸ—[3m[90m  121[0m  [39m  type
â›” [0mğŸ—[3m[90m  122[0m  [39m    NestedCallback = proc (): int
â›” [0mğŸ—[3m[90m  123[0m  [39m  proc outer() {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  124[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  125[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  126[0m  [39m    proc inner_callback(): NestedCallback =
â›” [0mğŸ—[3m[90m  127[0m  [39m      result = proc (): int =
â›” [0mğŸ—[3m[90m  128[0m  [39m        42
â›” [0mğŸ—[3m[90m  129[0m  [39m
â›” [0mğŸ—[3m[90m  130[0m  [39m    proc use_callback(cb: NestedCallback) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  131[0m  [39m      let result = cb()
â›” [0mğŸ—[3m[90m  132[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  133[0m  [39m      check result == 42
â›” [0mğŸ—[3m[90m  134[0m  [39m
â›” [0mğŸ—[3m[90m  135[0m  [39m    let cb = inner_callback()
â›” [0mğŸ—[3m[90m  136[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  137[0m  [39m    use_callback(cb)
â›” [0mğŸ—[3m[90m  138[0m  [39m
â›” [0mğŸ—[3m[90m  139[0m  [39m  outer()
â›” [0mğŸ—[3m[90m  140[0m  [39m  check k[0m
ğŸŸ¢ [32mcallback passed through multiple procedures[0m
ğŸŸ¢ [32mcallback stored in variable[0m
â›” [1m[7m[48;2;255;255;255m[91mcallback in array: compile failed[0m
â›” ğŸ—[3m[90m  190[0m  [39mblock:
â›” [0mğŸ—[3m[90m  191[0m  [39m  ## callback in array
â›” [0mğŸ—[3m[90m  192[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  193[0m  [39m  type
â›” [0mğŸ—[3m[90m  194[0m  [39m    ArrayCallback = proc (): int
â›” [0mğŸ—[3m[90m  195[0m  [39m  proc bar(cbs: array[2, ArrayCallback]) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  196[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  197[0m  [39m    let r1 = cbs[0]()
â›” [0mğŸ—[3m[90m  198[0m  [39m    let r2 = cbs[1]()
â›” [0mğŸ—[3m[90m  199[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  200[0m  [39m    check r1 == 1
â›” [0mğŸ—[3m[90m  201[0m  [39m    check r2 == 2
â›” [0mğŸ—[3m[90m  202[0m  [39m
â›” [0mğŸ—[3m[90m  203[0m  [39m  bar([proc (): int =
â›” [0mğŸ—[3m[90m  204[0m  [39m    1, proc (): int =
â›” [0mğŸ—[3m[90m  205[0m  [39m    2])
â›” [0mğŸ—[3m[90m  206[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(220) bar
ğŸ”´ [31mcallback with continuation call inside: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  210[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  211[0m  [39m  ## callback with continuation call inside
ğŸ”´ [0mğŸ—[3m[90m  212[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  213[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  214[0m  [39m    InnerCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  proc helper(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m    return x * 2
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m  proc bar(cb: InnerCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    let result = cb()
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m    check result == 20
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m  proc create_cb(): InnerCallback =
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m      return helper(10)
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m  bar(create_cb())
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(243) bar
ğŸ”´ [31mhigher-order callback (callback taking callback): [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  234[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  235[0m  [39m  ## higher-order callback (callback taking callback)
ğŸ”´ [0mğŸ—[3m[90m  236[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m    InnerCb = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m    OuterCb = proc (cb: InnerCb): int
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m  proc bar(cb: OuterCb) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m    let inner_cb = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      42
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    let result = cb(inner_cb)
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m  let hof = proc (inner: InnerCb): int =
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m  bar(hof)
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(260) bar
ğŸ”´ [31mcallback with multiple return paths: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  252[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  253[0m  [39m  ## callback with multiple return paths
ğŸ”´ [0mğŸ—[3m[90m  254[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m    MultiCallback = proc (x: int): int
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  proc bar(cb: MultiCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    let r1 = cb(0)
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    let r2 = cb(1)
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m    check r1 == 100
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m    check r2 == 1
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m  let multi_cb = proc (x: int): int =
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    if x == 0:
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m      100
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m      x
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  bar(multi_cb)
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(283) bar
ğŸ”´ [31mcallback with exception handling: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  275[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  276[0m  [39m  ## callback with exception handling
ğŸ”´ [0mğŸ—[3m[90m  277[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  278[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  279[0m  [39m    ExceptionCallback = proc (x: int): int
ğŸ”´ [0mğŸ—[3m[90m  280[0m  [39m  proc bar(cb: ExceptionCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  281[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  282[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  283[0m  [39m      let result = cb(-1)
ğŸ”´ [0mğŸ—[3m[90m  284[0m  [39m      fail "exception should have been raised"
ğŸ”´ [0mğŸ—[3m[90m  285[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  286[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  287[0m  [39m      discard
ğŸ”´ [0mğŸ—[3m[90m  288[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  289[0m  [39m  let exc_cb = proc (x: int): int =
ğŸ”´ [0mğŸ—[3m[90m  290[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m  291[0m  [39m      raise ValueError.newException "negative"
ğŸ”´ [0mğŸ—[3m[90m  292[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  293[0m  [39m    x
ğŸ”´ [0mğŸ—[3m[90m  294[0m  [39m  bar(exc_cb)
ğŸ”´ [0mğŸ—[3m[90m  295[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(307) bar
ğŸ”´ [31mcallback factory creating multiple callbacks: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  299[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  300[0m  [39m  ## callback factory creating multiple callbacks
ğŸ”´ [0mğŸ—[3m[90m  301[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  302[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  303[0m  [39m    FactoryCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  304[0m  [39m  proc bar(cbs: seq[FactoryCallback]) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  305[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  306[0m  [39m    var sum = 0
ğŸ”´ [0mğŸ—[3m[90m  307[0m  [39m    for cb in cbs:
ğŸ”´ [0mğŸ—[3m[90m  308[0m  [39m      sum = sum + cb()
ğŸ”´ [0mğŸ—[3m[90m  309[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  310[0m  [39m    check sum == 6
ğŸ”´ [0mğŸ—[3m[90m  311[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  312[0m  [39m  proc make_callback(value: int): FactoryCallback =
ğŸ”´ [0mğŸ—[3m[90m  313[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  314[0m  [39m      value
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  let callbacks = @[make_callback(1), make_callback(2), make_callback(3)]
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  bar(callbacks)
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mcallback with generic type parameter: compile failed[0m
â›” ğŸ—[3m[90m  325[0m  [39mblock:
â›” [0mğŸ—[3m[90m  326[0m  [39m  ## callback with generic type parameter
â›” [0mğŸ—[3m[90m  327[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  328[0m  [39m  type
â›” [0mğŸ—[3m[90m  329[0m  [39m    GenericCallback[T] = proc (): T
â›” [0mğŸ—[3m[90m  330[0m  [39m  proc bar[T](cb: GenericCallback[T]): T {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  331[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  332[0m  [39m    result = cb()
â›” [0mğŸ—[3m[90m  333[0m  [39m
â›” [0mğŸ—[3m[90m  334[0m  [39m  let int_cb: GenericCallback[int] = proc (): int =
â›” [0mğŸ—[3m[90m  335[0m  [39m    42
â›” [0mğŸ—[3m[90m  336[0m  [39m  let result = bar(int_cb)
â›” [0mğŸ—[3m[90m  337[0m  [39m  step 2
â›” [0mğŸ—[3m[90m  338[0m  [39m  check result == 42
â›” [0mğŸ—[3m[90m  339[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(349) bar
ğŸ”´ [31mcallback containing nested CPS procedure: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  341[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m  ## callback containing nested CPS procedure
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m    NestedCpsCallback = proc (): Continuation
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m  proc bar(cb: NestedCpsCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    let c = cb()
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m    trampoline c
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m  proc inner_cps() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  356[0m  [39m  let cps_cb = proc (): Continuation =
ğŸ”´ [0mğŸ—[3m[90m  357[0m  [39m    whelp inner_cps()
ğŸ”´ [0mğŸ—[3m[90m  358[0m  [39m  bar(cps_cb)
ğŸ”´ [0mğŸ—[3m[90m  359[0m  [39m  check k[0m
[3m[90m## [3m[97m16 tests  [0m          ğŸŸ¢4      ğŸ”´9    â›”3
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 85_callbacks: c arc debug execute                                     4.5s
ğŸƒ 92_exprs_nested: c arc debug execute                              
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t85_callbacks.nim
#24636/1 okay.
/run/user/1000/balls-nimcache-2436058822.c.debug.orc-24525/85_callbacks_24636_549516001790630388
#24636/2 fail!
[3m[90m## [3m[97mcallbacks[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(13) bar
ğŸ”´ [31mcallback return type Continuation: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m    5[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m    6[0m  [39m  ## callback return type Continuation
ğŸ”´ [0mğŸ—[3m[90m    7[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m    8[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m    9[0m  [39m    Callback = proc (): Continuation
ğŸ”´ [0mğŸ—[3m[90m   10[0m  [39m  proc bar(cb: Callback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   11[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   12[0m  [39m    let c = cb()
ğŸ”´ [0mğŸ—[3m[90m   13[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   14[0m  [39m    trampoline c
ğŸ”´ [0mğŸ—[3m[90m   15[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   16[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   17[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   18[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m   19[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   20[0m  [39m  proc callback_factory(): Callback =
ğŸ”´ [0mğŸ—[3m[90m   21[0m  [39m    result = proc (): Continuation =
ğŸ”´ [0mğŸ—[3m[90m   22[0m  [39m      whelp foo()
ğŸ”´ [0mğŸ—[3m[90m   23[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   24[0m  [39m  bar(callback_factory())
ğŸ”´ [0mğŸ—[3m[90m   25[0m  [39m  check k[0m
ğŸŸ¢ [32mcallback with int return type[0m
ğŸŸ¢ [32mcallback with arguments[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(84) bar
ğŸ”´ [31mcallback capturing closure variable: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   74[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   75[0m  [39m  ## callback capturing closure variable
ğŸ”´ [0mğŸ—[3m[90m   76[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   77[0m  [39m  var captured = 10
ğŸ”´ [0mğŸ—[3m[90m   78[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m   79[0m  [39m    ClosureCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m   80[0m  [39m  proc bar(cb: ClosureCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m   81[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m   82[0m  [39m    let result = cb()
ğŸ”´ [0mğŸ—[3m[90m   83[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m   84[0m  [39m    check result == 10
ğŸ”´ [0mğŸ—[3m[90m   85[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   86[0m  [39m  proc create_callback(): ClosureCallback =
ğŸ”´ [0mğŸ—[3m[90m   87[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m   88[0m  [39m      captured
ğŸ”´ [0mğŸ—[3m[90m   89[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m   90[0m  [39m  bar(create_callback())
ğŸ”´ [0mğŸ—[3m[90m   91[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(104) bar
ğŸ”´ [31mcallback with mutable closure: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m   94[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m   95[0m  [39m  ## callback with mutable closure
ğŸ”´ [0mğŸ—[3m[90m   96[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m   97[0m  [39m  var counter = 0
ğŸ”´ [0mğŸ—[3m[90m   98[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m   99[0m  [39m    MutableCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  100[0m  [39m  proc bar(cb: MutableCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  101[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  102[0m  [39m    let val1 = cb()
ğŸ”´ [0mğŸ—[3m[90m  103[0m  [39m    let val2 = cb()
ğŸ”´ [0mğŸ—[3m[90m  104[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  105[0m  [39m    check val1 == 1
ğŸ”´ [0mğŸ—[3m[90m  106[0m  [39m    check val2 == 2
ğŸ”´ [0mğŸ—[3m[90m  107[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  108[0m  [39m  proc create_callback(): MutableCallback =
ğŸ”´ [0mğŸ—[3m[90m  109[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  110[0m  [39m      inc counter
ğŸ”´ [0mğŸ—[3m[90m  111[0m  [39m      counter
ğŸ”´ [0mğŸ—[3m[90m  112[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  113[0m  [39m  bar(create_callback())
ğŸ”´ [0mğŸ—[3m[90m  114[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mnested callback definition: compile failed[0m
â›” ğŸ—[3m[90m  118[0m  [39mblock:
â›” [0mğŸ—[3m[90m  119[0m  [39m  ## nested callback definition
â›” [0mğŸ—[3m[90m  120[0m  [39m  var k = newKiller 3
â›” [0mğŸ—[3m[90m  121[0m  [39m  type
â›” [0mğŸ—[3m[90m  122[0m  [39m    NestedCallback = proc (): int
â›” [0mğŸ—[3m[90m  123[0m  [39m  proc outer() {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  124[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  125[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  126[0m  [39m    proc inner_callback(): NestedCallback =
â›” [0mğŸ—[3m[90m  127[0m  [39m      result = proc (): int =
â›” [0mğŸ—[3m[90m  128[0m  [39m        42
â›” [0mğŸ—[3m[90m  129[0m  [39m
â›” [0mğŸ—[3m[90m  130[0m  [39m    proc use_callback(cb: NestedCallback) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  131[0m  [39m      let result = cb()
â›” [0mğŸ—[3m[90m  132[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  133[0m  [39m      check result == 42
â›” [0mğŸ—[3m[90m  134[0m  [39m
â›” [0mğŸ—[3m[90m  135[0m  [39m    let cb = inner_callback()
â›” [0mğŸ—[3m[90m  136[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  137[0m  [39m    use_callback(cb)
â›” [0mğŸ—[3m[90m  138[0m  [39m
â›” [0mğŸ—[3m[90m  139[0m  [39m  outer()
â›” [0mğŸ—[3m[90m  140[0m  [39m  check k[0m
ğŸŸ¢ [32mcallback passed through multiple procedures[0m
ğŸŸ¢ [32mcallback stored in variable[0m
â›” [1m[7m[48;2;255;255;255m[91mcallback in array: compile failed[0m
â›” ğŸ—[3m[90m  190[0m  [39mblock:
â›” [0mğŸ—[3m[90m  191[0m  [39m  ## callback in array
â›” [0mğŸ—[3m[90m  192[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  193[0m  [39m  type
â›” [0mğŸ—[3m[90m  194[0m  [39m    ArrayCallback = proc (): int
â›” [0mğŸ—[3m[90m  195[0m  [39m  proc bar(cbs: array[2, ArrayCallback]) {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  196[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  197[0m  [39m    let r1 = cbs[0]()
â›” [0mğŸ—[3m[90m  198[0m  [39m    let r2 = cbs[1]()
â›” [0mğŸ—[3m[90m  199[0m  [39m    step 2
â›” [0mğŸ—[3m[90m  200[0m  [39m    check r1 == 1
â›” [0mğŸ—[3m[90m  201[0m  [39m    check r2 == 2
â›” [0mğŸ—[3m[90m  202[0m  [39m
â›” [0mğŸ—[3m[90m  203[0m  [39m  bar([proc (): int =
â›” [0mğŸ—[3m[90m  204[0m  [39m    1, proc (): int =
â›” [0mğŸ—[3m[90m  205[0m  [39m    2])
â›” [0mğŸ—[3m[90m  206[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(220) bar
ğŸ”´ [31mcallback with continuation call inside: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  210[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  211[0m  [39m  ## callback with continuation call inside
ğŸ”´ [0mğŸ—[3m[90m  212[0m  [39m  var k = newKiller 3
ğŸ”´ [0mğŸ—[3m[90m  213[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  214[0m  [39m    InnerCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  215[0m  [39m  proc helper(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  216[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  217[0m  [39m    return x * 2
ğŸ”´ [0mğŸ—[3m[90m  218[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  219[0m  [39m  proc bar(cb: InnerCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  220[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  221[0m  [39m    let result = cb()
ğŸ”´ [0mğŸ—[3m[90m  222[0m  [39m    step 3
ğŸ”´ [0mğŸ—[3m[90m  223[0m  [39m    check result == 20
ğŸ”´ [0mğŸ—[3m[90m  224[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  225[0m  [39m  proc create_cb(): InnerCallback =
ğŸ”´ [0mğŸ—[3m[90m  226[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  227[0m  [39m      step 1
ğŸ”´ [0mğŸ—[3m[90m  228[0m  [39m      return helper(10)
ğŸ”´ [0mğŸ—[3m[90m  229[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  230[0m  [39m  bar(create_cb())
ğŸ”´ [0mğŸ—[3m[90m  231[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(243) bar
ğŸ”´ [31mhigher-order callback (callback taking callback): [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  234[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  235[0m  [39m  ## higher-order callback (callback taking callback)
ğŸ”´ [0mğŸ—[3m[90m  236[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  237[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  238[0m  [39m    InnerCb = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  239[0m  [39m    OuterCb = proc (cb: InnerCb): int
ğŸ”´ [0mğŸ—[3m[90m  240[0m  [39m  proc bar(cb: OuterCb) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  241[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  242[0m  [39m    let inner_cb = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  243[0m  [39m      42
ğŸ”´ [0mğŸ—[3m[90m  244[0m  [39m    let result = cb(inner_cb)
ğŸ”´ [0mğŸ—[3m[90m  245[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  246[0m  [39m    check result == 42
ğŸ”´ [0mğŸ—[3m[90m  247[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  248[0m  [39m  let hof = proc (inner: InnerCb): int =
ğŸ”´ [0mğŸ—[3m[90m  249[0m  [39m    inner()
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m  bar(hof)
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(260) bar
ğŸ”´ [31mcallback with multiple return paths: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  252[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  253[0m  [39m  ## callback with multiple return paths
ğŸ”´ [0mğŸ—[3m[90m  254[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m    MultiCallback = proc (x: int): int
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m  proc bar(cb: MultiCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m    let r1 = cb(0)
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m    let r2 = cb(1)
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m    check r1 == 100
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m    check r2 == 1
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m  let multi_cb = proc (x: int): int =
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m    if x == 0:
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m      100
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  269[0m  [39m      x
ğŸ”´ [0mğŸ—[3m[90m  270[0m  [39m  bar(multi_cb)
ğŸ”´ [0mğŸ—[3m[90m  271[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(283) bar
ğŸ”´ [31mcallback with exception handling: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  275[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  276[0m  [39m  ## callback with exception handling
ğŸ”´ [0mğŸ—[3m[90m  277[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  278[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  279[0m  [39m    ExceptionCallback = proc (x: int): int
ğŸ”´ [0mğŸ—[3m[90m  280[0m  [39m  proc bar(cb: ExceptionCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  281[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  282[0m  [39m    try:
ğŸ”´ [0mğŸ—[3m[90m  283[0m  [39m      let result = cb(-1)
ğŸ”´ [0mğŸ—[3m[90m  284[0m  [39m      fail "exception should have been raised"
ğŸ”´ [0mğŸ—[3m[90m  285[0m  [39m    except ValueError:
ğŸ”´ [0mğŸ—[3m[90m  286[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  287[0m  [39m      discard
ğŸ”´ [0mğŸ—[3m[90m  288[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  289[0m  [39m  let exc_cb = proc (x: int): int =
ğŸ”´ [0mğŸ—[3m[90m  290[0m  [39m    if x < 0:
ğŸ”´ [0mğŸ—[3m[90m  291[0m  [39m      raise ValueError.newException "negative"
ğŸ”´ [0mğŸ—[3m[90m  292[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  293[0m  [39m    x
ğŸ”´ [0mğŸ—[3m[90m  294[0m  [39m  bar(exc_cb)
ğŸ”´ [0mğŸ—[3m[90m  295[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(307) bar
ğŸ”´ [31mcallback factory creating multiple callbacks: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  299[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  300[0m  [39m  ## callback factory creating multiple callbacks
ğŸ”´ [0mğŸ—[3m[90m  301[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  302[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  303[0m  [39m    FactoryCallback = proc (): int
ğŸ”´ [0mğŸ—[3m[90m  304[0m  [39m  proc bar(cbs: seq[FactoryCallback]) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  305[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  306[0m  [39m    var sum = 0
ğŸ”´ [0mğŸ—[3m[90m  307[0m  [39m    for cb in cbs:
ğŸ”´ [0mğŸ—[3m[90m  308[0m  [39m      sum = sum + cb()
ğŸ”´ [0mğŸ—[3m[90m  309[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  310[0m  [39m    check sum == 6
ğŸ”´ [0mğŸ—[3m[90m  311[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  312[0m  [39m  proc make_callback(value: int): FactoryCallback =
ğŸ”´ [0mğŸ—[3m[90m  313[0m  [39m    result = proc (): int =
ğŸ”´ [0mğŸ—[3m[90m  314[0m  [39m      value
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m  let callbacks = @[make_callback(1), make_callback(2), make_callback(3)]
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m  bar(callbacks)
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m  check k[0m
â›” [1m[7m[48;2;255;255;255m[91mcallback with generic type parameter: compile failed[0m
â›” ğŸ—[3m[90m  325[0m  [39mblock:
â›” [0mğŸ—[3m[90m  326[0m  [39m  ## callback with generic type parameter
â›” [0mğŸ—[3m[90m  327[0m  [39m  var k = newKiller 2
â›” [0mğŸ—[3m[90m  328[0m  [39m  type
â›” [0mğŸ—[3m[90m  329[0m  [39m    GenericCallback[T] = proc (): T
â›” [0mğŸ—[3m[90m  330[0m  [39m  proc bar[T](cb: GenericCallback[T]): T {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  331[0m  [39m    noop()
â›” [0mğŸ—[3m[90m  332[0m  [39m    result = cb()
â›” [0mğŸ—[3m[90m  333[0m  [39m
â›” [0mğŸ—[3m[90m  334[0m  [39m  let int_cb: GenericCallback[int] = proc (): int =
â›” [0mğŸ—[3m[90m  335[0m  [39m    42
â›” [0mğŸ—[3m[90m  336[0m  [39m  let result = bar(int_cb)
â›” [0mğŸ—[3m[90m  337[0m  [39m  step 2
â›” [0mğŸ—[3m[90m  338[0m  [39m  check result == 42
â›” [0mğŸ—[3m[90m  339[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t85_callbacks.nim(349) bar
ğŸ”´ [31mcallback containing nested CPS procedure: [3m[97mexpected step 1 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  341[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  342[0m  [39m  ## callback containing nested CPS procedure
ğŸ”´ [0mğŸ—[3m[90m  343[0m  [39m  var k = newKiller 2
ğŸ”´ [0mğŸ—[3m[90m  344[0m  [39m  type
ğŸ”´ [0mğŸ—[3m[90m  345[0m  [39m    NestedCpsCallback = proc (): Continuation
ğŸ”´ [0mğŸ—[3m[90m  346[0m  [39m  proc bar(cb: NestedCpsCallback) {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  347[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  348[0m  [39m    let c = cb()
ğŸ”´ [0mğŸ—[3m[90m  349[0m  [39m    step 2
ğŸ”´ [0mğŸ—[3m[90m  350[0m  [39m    trampoline c
ğŸ”´ [0mğŸ—[3m[90m  351[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  352[0m  [39m  proc inner_cps() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  353[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  354[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  355[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  356[0m  [39m  let cps_cb = proc (): Continuation =
ğŸ”´ [0mğŸ—[3m[90m  357[0m  [39m    whelp inner_cps()
ğŸ”´ [0mğŸ—[3m[90m  358[0m  [39m  bar(cps_cb)
ğŸ”´ [0mğŸ—[3m[90m  359[0m  [39m  check k[0m
[3m[90m## [3m[97m16 tests  [0m          ğŸŸ¢4      ğŸ”´9    â›”3
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 85_callbacks: c orc debug execute                                     4.5s
ğŸƒ 92_exprs_nested: c orc debug execute                              
ğŸŸ¢ 80_exceptions_extended: c arc release execute                         7.6s
ğŸƒ 92_exprs_nested: c arc release execute                            
ğŸŸ¢ 90_exprs1: c arc release execute                                      5.0s
ğŸƒ 92_exprs_nested: c orc release execute                            
ğŸŸ¢ 90_exprs2: c arc release execute                                      4.4s
ğŸƒ 93_exprs_complex: c arc debug execute                             
ğŸŸ¢ 90_exprs1: c orc release execute                                      5.3s
ğŸƒ 93_exprs_complex: c orc debug execute                             
ğŸŸ¢ 80_exceptions_extended: c orc release execute                         7.7s
ğŸƒ 93_exprs_complex: c arc release execute                           
ğŸŸ¢ 90_exprs2: c orc release execute                                      4.7s
ğŸƒ 93_exprs_complex: c orc release execute                           
ğŸŸ¢ 90_exprs4: c arc debug execute                                        4.8s
ğŸƒ 94_type_handling: c arc debug execute                             
ğŸŸ¢ 90_exprs4: c orc debug execute                                        4.8s
ğŸƒ 94_type_handling: c orc debug execute                             
ğŸŸ¢ 90_exprs5: c arc debug execute                                        3.8s
ğŸƒ 94_type_handling: c arc release execute                           
ğŸŸ¢ 90_exprs5: c orc debug execute                                        3.8s
ğŸŸ¢ 90_exprs4: c arc release execute                                      5.6s
ğŸƒ 94_type_handling: c orc release execute                           
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t92_exprs_nested.nim
#24629/1 fail!
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 18) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 5) template/generic instantiation of `cpsTransform` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(138, 11) Error: for loop with a cps call inside is not supported
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 18) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 5) Error: undeclared identifier: 'foo_50337176'
candidates (edit distance, scope distance); see '--spellSuggest':
 (8, 7): 'float32' [type declared in /home/adavidoff/.asdf/installs/nimskull/0.1.0-dev.21571/lib/system.nim(27, 3)]
 (8, 7): 'toU16' [proc declared in /home/adavidoff/.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/arithmetics.nim(92, 8)]
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 92_exprs_nested: c arc release execute                                2.5s
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --define:release --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t92_exprs_nested.nim
#24638/1 fail!
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 18) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 5) template/generic instantiation of `cpsTransform` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(138, 11) Error: for loop with a cps call inside is not supported
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(3, 7) template/generic instantiation of `suite` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 18) template/generic instantiation of `cps` from here
/home/adavidoff/git/cps/cps.nim(86, 37) template/generic instantiation of `cpsTyped` from here
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(132, 5) Error: undeclared identifier: 'foo_50337412'
candidates (edit distance, scope distance); see '--spellSuggest':
 (7, 7): 'float32' [type declared in /home/adavidoff/.asdf/installs/nimskull/0.1.0-dev.21571/lib/system.nim(27, 3)]
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 92_exprs_nested: c orc release execute                                2.6s
ğŸŸ¢ 90_exprs4: c orc release execute                                      5.9s
ğŸŸ¢ 90_exprs5: c arc release execute                                      4.8s
ğŸŸ¢ 93_exprs_complex: c arc debug execute                                 3.5s
ğŸŸ¢ 94_type_handling: c arc debug execute                                 2.5s
ğŸŸ¢ 90_exprs5: c orc release execute                                      4.9s
ğŸŸ¢ 94_type_handling: c orc debug execute                                 2.6s
ğŸŸ¢ 93_exprs_complex: c orc debug execute                                 3.7s
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:arc --threads:on tests/t92_exprs_nested.nim
#24627/1 okay.
/run/user/1000/balls-nimcache-1672519744.c.debug.arc-24525/92_exprs_nested_24627_-7969309871980066586
#24627/2 fail!
[3m[90m## [3m[97mnested expression flattening[0m
ğŸŸ¢ [32mnested if expressions[0m
ğŸŸ¢ [32mnested case expressions[0m
ğŸŸ¢ [32mif containing case[0m
ğŸŸ¢ [32mcase containing if[0m
ğŸŸ¢ [32mdeeply nested if expressions[0m
â›” [1m[7m[48;2;255;255;255m[91mfor loop expression: compile failed[0m
â›” ğŸ—[3m[90m  131[0m  [39mblock:
â›” [0mğŸ—[3m[90m  132[0m  [39m  ## for loop expression
â›” [0mğŸ—[3m[90m  133[0m  [39m  var k = newKiller(4)
â›” [0mğŸ—[3m[90m  134[0m  [39m  proc foo() {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  135[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  136[0m  [39m    let result = block:
â›” [0mğŸ—[3m[90m  137[0m  [39m      var sum = 0
â›” [0mğŸ—[3m[90m  138[0m  [39m      for i in 0 .. 3:
â›” [0mğŸ—[3m[90m  139[0m  [39m        noop()
â›” [0mğŸ—[3m[90m  140[0m  [39m        step 2
â›” [0mğŸ—[3m[90m  141[0m  [39m        sum = sum + i
â›” [0mğŸ—[3m[90m  142[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  143[0m  [39m      sum
â›” [0mğŸ—[3m[90m  144[0m  [39m    check result == 6
â›” [0mğŸ—[3m[90m  145[0m  [39m    step 4
â›” [0mğŸ—[3m[90m  146[0m  [39m
â›” [0mğŸ—[3m[90m  147[0m  [39m  foo()
â›” [0mğŸ—[3m[90m  148[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/killer.nim(54) foo
ğŸ”´ [31mwhile loop expression: [3m[97mexpected step 3 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  152[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m  ## while loop expression
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m    let result = block:
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m      var i = 0
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m      while i < 3:
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m        inc i
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m      i
ğŸ”´ [0mğŸ—[3m[90m  165[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  166[0m  [39m    step 4
ğŸ”´ [0mğŸ—[3m[90m  167[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  168[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  169[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  170[0m  [39m  check k[0m
ğŸŸ¢ [32mobject construction with flattened expressions[0m
ğŸŸ¢ [32marray construction with nested expressions[0m
ğŸŸ¢ [32msequence construction with expressions[0m
ğŸŸ¢ [32mtuple construction with flattened expressions[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(253) foo
ğŸ”´ [31mif with nested try-except: [3m[97mexpected step 3 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  249[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m  ## if with nested try-except
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  253[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  254[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m      try:
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m        42
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m      except:
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m        -1 else:
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m      -2
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    check x == 42
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(277) foo
ğŸ”´ [31mcase with try-except blocks: [3m[97mexpected step 3 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  273[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  274[0m  [39m  ## case with try-except blocks
ğŸ”´ [0mğŸ—[3m[90m  275[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  276[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  277[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  278[0m  [39m    let x = case "test"
ğŸ”´ [0mğŸ—[3m[90m  279[0m  [39m    of "test":
ğŸ”´ [0mğŸ—[3m[90m  280[0m  [39m      try:
ğŸ”´ [0mğŸ—[3m[90m  281[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  282[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  283[0m  [39m        100
ğŸ”´ [0mğŸ—[3m[90m  284[0m  [39m      except:
ğŸ”´ [0mğŸ—[3m[90m  285[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  286[0m  [39m        -1
ğŸ”´ [0mğŸ—[3m[90m  287[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  288[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  289[0m  [39m      -2
ğŸ”´ [0mğŸ—[3m[90m  290[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  291[0m  [39m    check x == 100
ğŸ”´ [0mğŸ—[3m[90m  292[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  293[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  294[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(302) foo
ğŸ”´ [31mif in case in if nesting: [3m[97mexpected step 5 but hit 6[0m[0m
ğŸ”´ ğŸ—[3m[90m  298[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  299[0m  [39m  ## if in case in if nesting
ğŸ”´ [0mğŸ—[3m[90m  300[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  301[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  302[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  303[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  304[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  305[0m  [39m      case 1
ğŸ”´ [0mğŸ—[3m[90m  306[0m  [39m      of 1:
ğŸ”´ [0mğŸ—[3m[90m  307[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  308[0m  [39m        if true:
ğŸ”´ [0mğŸ—[3m[90m  309[0m  [39m          noop()
ğŸ”´ [0mğŸ—[3m[90m  310[0m  [39m          step 4
ğŸ”´ [0mğŸ—[3m[90m  311[0m  [39m          777
ğŸ”´ [0mğŸ—[3m[90m  312[0m  [39m        else:
ğŸ”´ [0mğŸ—[3m[90m  313[0m  [39m          -1
ğŸ”´ [0mğŸ—[3m[90m  314[0m  [39m      else:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m        step 5
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m        -2 else:
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m      -3
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    check x == 777
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m  check k[0m
ğŸŸ¢ [32mmultiple nested branches with different paths[0m
ğŸŸ¢ [32mnested block expressions[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(387) foo
ğŸ”´ [31mexpression with continuation calls in branches: [3m[97mexpected step 4 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  379[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  380[0m  [39m  ## expression with continuation calls in branches
ğŸ”´ [0mğŸ—[3m[90m  381[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  382[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  383[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  384[0m  [39m    return x * 2
ğŸ”´ [0mğŸ—[3m[90m  385[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  386[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  387[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  388[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  389[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  390[0m  [39m      let val = inner(5)
ğŸ”´ [0mğŸ—[3m[90m  391[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  392[0m  [39m      val else:
ğŸ”´ [0mğŸ—[3m[90m  393[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  394[0m  [39m      -1
ğŸ”´ [0mğŸ—[3m[90m  395[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  396[0m  [39m    check x == 10
ğŸ”´ [0mğŸ—[3m[90m  397[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  398[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  399[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  400[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(413) foo
ğŸ”´ [31mcase with continuation calls in branches: [3m[97mexpected step 4 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  405[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  406[0m  [39m  ## case with continuation calls in branches
ğŸ”´ [0mğŸ—[3m[90m  407[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  408[0m  [39m  proc helper(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  409[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  410[0m  [39m    return x + 10
ğŸ”´ [0mğŸ—[3m[90m  411[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  412[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  413[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  414[0m  [39m    let x = case 1
ğŸ”´ [0mğŸ—[3m[90m  415[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m  416[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  417[0m  [39m      let val = helper(5)
ğŸ”´ [0mğŸ—[3m[90m  418[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  419[0m  [39m      val
ğŸ”´ [0mğŸ—[3m[90m  420[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  421[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  422[0m  [39m      -1
ğŸ”´ [0mğŸ—[3m[90m  423[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  424[0m  [39m    check x == 15
ğŸ”´ [0mğŸ—[3m[90m  425[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  426[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  427[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  428[0m  [39m  check k[0m
[3m[90m## [3m[97m18 tests  [0m          ğŸŸ¢11      ğŸ”´6    â›”1
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 92_exprs_nested: c arc debug execute                                  6.2s
/home/adavidoff/.asdf/shims/nim c --parallelBuild:1 --debuginfo:on --lineTrace:on --stackTrace:on --excessiveStackTrace:on --gc:orc --threads:on tests/t92_exprs_nested.nim
#24636/1 okay.
/run/user/1000/balls-nimcache-1672519744.c.debug.orc-24525/92_exprs_nested_24636_444379842638146236
#24636/2 fail!
[3m[90m## [3m[97mnested expression flattening[0m
ğŸŸ¢ [32mnested if expressions[0m
ğŸŸ¢ [32mnested case expressions[0m
ğŸŸ¢ [32mif containing case[0m
ğŸŸ¢ [32mcase containing if[0m
ğŸŸ¢ [32mdeeply nested if expressions[0m
â›” [1m[7m[48;2;255;255;255m[91mfor loop expression: compile failed[0m
â›” ğŸ—[3m[90m  131[0m  [39mblock:
â›” [0mğŸ—[3m[90m  132[0m  [39m  ## for loop expression
â›” [0mğŸ—[3m[90m  133[0m  [39m  var k = newKiller(4)
â›” [0mğŸ—[3m[90m  134[0m  [39m  proc foo() {.cps: Cont.} =
â›” [0mğŸ—[3m[90m  135[0m  [39m    step 1
â›” [0mğŸ—[3m[90m  136[0m  [39m    let result = block:
â›” [0mğŸ—[3m[90m  137[0m  [39m      var sum = 0
â›” [0mğŸ—[3m[90m  138[0m  [39m      for i in 0 .. 3:
â›” [0mğŸ—[3m[90m  139[0m  [39m        noop()
â›” [0mğŸ—[3m[90m  140[0m  [39m        step 2
â›” [0mğŸ—[3m[90m  141[0m  [39m        sum = sum + i
â›” [0mğŸ—[3m[90m  142[0m  [39m      step 3
â›” [0mğŸ—[3m[90m  143[0m  [39m      sum
â›” [0mğŸ—[3m[90m  144[0m  [39m    check result == 6
â›” [0mğŸ—[3m[90m  145[0m  [39m    step 4
â›” [0mğŸ—[3m[90m  146[0m  [39m
â›” [0mğŸ—[3m[90m  147[0m  [39m  foo()
â›” [0mğŸ—[3m[90m  148[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/killer.nim(54) foo
ğŸ”´ [31mwhile loop expression: [3m[97mexpected step 3 but hit 2[0m[0m
ğŸ”´ ğŸ—[3m[90m  152[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  153[0m  [39m  ## while loop expression
ğŸ”´ [0mğŸ—[3m[90m  154[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  155[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  156[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  157[0m  [39m    let result = block:
ğŸ”´ [0mğŸ—[3m[90m  158[0m  [39m      var i = 0
ğŸ”´ [0mğŸ—[3m[90m  159[0m  [39m      while i < 3:
ğŸ”´ [0mğŸ—[3m[90m  160[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  161[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  162[0m  [39m        inc i
ğŸ”´ [0mğŸ—[3m[90m  163[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  164[0m  [39m      i
ğŸ”´ [0mğŸ—[3m[90m  165[0m  [39m    check result == 3
ğŸ”´ [0mğŸ—[3m[90m  166[0m  [39m    step 4
ğŸ”´ [0mğŸ—[3m[90m  167[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  168[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  169[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  170[0m  [39m  check k[0m
ğŸŸ¢ [32mobject construction with flattened expressions[0m
ğŸŸ¢ [32marray construction with nested expressions[0m
ğŸŸ¢ [32msequence construction with expressions[0m
ğŸŸ¢ [32mtuple construction with flattened expressions[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(253) foo
ğŸ”´ [31mif with nested try-except: [3m[97mexpected step 3 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  249[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  250[0m  [39m  ## if with nested try-except
ğŸ”´ [0mğŸ—[3m[90m  251[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  252[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  253[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  254[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  255[0m  [39m      try:
ğŸ”´ [0mğŸ—[3m[90m  256[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  257[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  258[0m  [39m        42
ğŸ”´ [0mğŸ—[3m[90m  259[0m  [39m      except:
ğŸ”´ [0mğŸ—[3m[90m  260[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  261[0m  [39m        -1 else:
ğŸ”´ [0mğŸ—[3m[90m  262[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  263[0m  [39m      -2
ğŸ”´ [0mğŸ—[3m[90m  264[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  265[0m  [39m    check x == 42
ğŸ”´ [0mğŸ—[3m[90m  266[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  267[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  268[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(277) foo
ğŸ”´ [31mcase with try-except blocks: [3m[97mexpected step 3 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  273[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  274[0m  [39m  ## case with try-except blocks
ğŸ”´ [0mğŸ—[3m[90m  275[0m  [39m  var k = newKiller(5)
ğŸ”´ [0mğŸ—[3m[90m  276[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  277[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  278[0m  [39m    let x = case "test"
ğŸ”´ [0mğŸ—[3m[90m  279[0m  [39m    of "test":
ğŸ”´ [0mğŸ—[3m[90m  280[0m  [39m      try:
ğŸ”´ [0mğŸ—[3m[90m  281[0m  [39m        noop()
ğŸ”´ [0mğŸ—[3m[90m  282[0m  [39m        step 2
ğŸ”´ [0mğŸ—[3m[90m  283[0m  [39m        100
ğŸ”´ [0mğŸ—[3m[90m  284[0m  [39m      except:
ğŸ”´ [0mğŸ—[3m[90m  285[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  286[0m  [39m        -1
ğŸ”´ [0mğŸ—[3m[90m  287[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  288[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  289[0m  [39m      -2
ğŸ”´ [0mğŸ—[3m[90m  290[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  291[0m  [39m    check x == 100
ğŸ”´ [0mğŸ—[3m[90m  292[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  293[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  294[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(302) foo
ğŸ”´ [31mif in case in if nesting: [3m[97mexpected step 5 but hit 6[0m[0m
ğŸ”´ ğŸ—[3m[90m  298[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  299[0m  [39m  ## if in case in if nesting
ğŸ”´ [0mğŸ—[3m[90m  300[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  301[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  302[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  303[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  304[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  305[0m  [39m      case 1
ğŸ”´ [0mğŸ—[3m[90m  306[0m  [39m      of 1:
ğŸ”´ [0mğŸ—[3m[90m  307[0m  [39m        step 3
ğŸ”´ [0mğŸ—[3m[90m  308[0m  [39m        if true:
ğŸ”´ [0mğŸ—[3m[90m  309[0m  [39m          noop()
ğŸ”´ [0mğŸ—[3m[90m  310[0m  [39m          step 4
ğŸ”´ [0mğŸ—[3m[90m  311[0m  [39m          777
ğŸ”´ [0mğŸ—[3m[90m  312[0m  [39m        else:
ğŸ”´ [0mğŸ—[3m[90m  313[0m  [39m          -1
ğŸ”´ [0mğŸ—[3m[90m  314[0m  [39m      else:
ğŸ”´ [0mğŸ—[3m[90m  315[0m  [39m        step 5
ğŸ”´ [0mğŸ—[3m[90m  316[0m  [39m        -2 else:
ğŸ”´ [0mğŸ—[3m[90m  317[0m  [39m      -3
ğŸ”´ [0mğŸ—[3m[90m  318[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  319[0m  [39m    check x == 777
ğŸ”´ [0mğŸ—[3m[90m  320[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  321[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  322[0m  [39m  check k[0m
ğŸŸ¢ [32mmultiple nested branches with different paths[0m
ğŸŸ¢ [32mnested block expressions[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(387) foo
ğŸ”´ [31mexpression with continuation calls in branches: [3m[97mexpected step 4 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  379[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  380[0m  [39m  ## expression with continuation calls in branches
ğŸ”´ [0mğŸ—[3m[90m  381[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  382[0m  [39m  proc inner(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  383[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  384[0m  [39m    return x * 2
ğŸ”´ [0mğŸ—[3m[90m  385[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  386[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  387[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  388[0m  [39m    let x = if true:
ğŸ”´ [0mğŸ—[3m[90m  389[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  390[0m  [39m      let val = inner(5)
ğŸ”´ [0mğŸ—[3m[90m  391[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  392[0m  [39m      val else:
ğŸ”´ [0mğŸ—[3m[90m  393[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  394[0m  [39m      -1
ğŸ”´ [0mğŸ—[3m[90m  395[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  396[0m  [39m    check x == 10
ğŸ”´ [0mğŸ—[3m[90m  397[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  398[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  399[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  400[0m  [39m  check k[0m
[3m[90m## [3m[97mproc == from [0m[3m[4m[94m../../../.asdf/installs/nimskull/0.1.0-dev.21571/lib/system/comparisons.nim[0m [0m[3m[90m143[0m[0m
[3m[90m## [3m[97mvar k: object
  final
  n
 = (unsupported on arc/orc)[0m
[3m[90m## [3m[97mfield n: (afraid to check type or value)[0m
/home/adavidoff/git/cps/tests/t92_exprs_nested.nim(413) foo
ğŸ”´ [31mcase with continuation calls in branches: [3m[97mexpected step 4 but hit 5[0m[0m
ğŸ”´ ğŸ—[3m[90m  405[0m  [39mblock:
ğŸ”´ [0mğŸ—[3m[90m  406[0m  [39m  ## case with continuation calls in branches
ğŸ”´ [0mğŸ—[3m[90m  407[0m  [39m  var k = newKiller(6)
ğŸ”´ [0mğŸ—[3m[90m  408[0m  [39m  proc helper(x: int): int {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  409[0m  [39m    noop()
ğŸ”´ [0mğŸ—[3m[90m  410[0m  [39m    return x + 10
ğŸ”´ [0mğŸ—[3m[90m  411[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  412[0m  [39m  proc foo() {.cps: Cont.} =
ğŸ”´ [0mğŸ—[3m[90m  413[0m  [39m    step 1
ğŸ”´ [0mğŸ—[3m[90m  414[0m  [39m    let x = case 1
ğŸ”´ [0mğŸ—[3m[90m  415[0m  [39m    of 1:
ğŸ”´ [0mğŸ—[3m[90m  416[0m  [39m      step 2
ğŸ”´ [0mğŸ—[3m[90m  417[0m  [39m      let val = helper(5)
ğŸ”´ [0mğŸ—[3m[90m  418[0m  [39m      step 3
ğŸ”´ [0mğŸ—[3m[90m  419[0m  [39m      val
ğŸ”´ [0mğŸ—[3m[90m  420[0m  [39m    else:
ğŸ”´ [0mğŸ—[3m[90m  421[0m  [39m      step 4
ğŸ”´ [0mğŸ—[3m[90m  422[0m  [39m      -1
ğŸ”´ [0mğŸ—[3m[90m  423[0m  [39m    step 5
ğŸ”´ [0mğŸ—[3m[90m  424[0m  [39m    check x == 15
ğŸ”´ [0mğŸ—[3m[90m  425[0m  [39m    step 6
ğŸ”´ [0mğŸ—[3m[90m  426[0m  [39m
ğŸ”´ [0mğŸ—[3m[90m  427[0m  [39m  foo()
ğŸ”´ [0mğŸ—[3m[90m  428[0m  [39m  check k[0m
[3m[90m## [3m[97m18 tests  [0m          ğŸŸ¢11      ğŸ”´6    â›”1
failure; compiler NimSkull-0.1.0-dev.21571 in /home/adavidoff/.asdf/shims/nim
date 2026-01-18 sha1 7898cfcb12cd97fe7cd6c0ccfeb0d35cb6dd8c75
ğŸ”´ 92_exprs_nested: c orc debug execute                                  6.4s
ğŸŸ¢ 93_exprs_complex: c arc release execute                               5.0s
ğŸŸ¢ 93_exprs_complex: c orc release execute                               5.1s
ğŸŸ¢ 94_type_handling: c arc release execute                               3.6s
ğŸŸ¢ 94_type_handling: c orc release execute                               3.8s
